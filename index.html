<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetControl Pro V3.0 - Sistema Avançado de Gestão de Frota</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#FF6B35',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        info: '#3B82F6'
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'pulse-slow': 'pulse 3s infinite',
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'scale-in': 'scaleIn 0.2s ease-out'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
            <p class="text-gray-700 dark:text-gray-300 font-medium">Processando...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-lg border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="relative">
                        <i class="fas fa-truck text-primary text-3xl mr-3 animate-pulse-slow"></i>
                        <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-success rounded-full border-2 border-white dark:border-gray-800 animate-bounce-slow" title="Sistema Online"></div>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 dark:text-white">FleetControl Pro</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Sistema Avançado de Gestão de Frota v3.0</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="hidden md:block text-right">
                        <p class="text-sm font-medium text-gray-900 dark:text-white" id="currentDateTime"></p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Última atualização</p>
                    </div>
                    
                    <!-- Enhanced Quick Stats -->
                    <div class="hidden lg:flex items-center space-x-4 px-4 py-2 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 rounded-lg border border-gray-200 dark:border-gray-600">
                        <div class="text-center">
                            <span class="text-xs text-gray-500 dark:text-gray-400">Veículos</span>
                            <div class="text-sm font-bold text-primary" id="headerVehicleCount">0</div>
                        </div>
                        <div class="h-6 w-px bg-gray-300 dark:bg-gray-500"></div>
                        <div class="text-center">
                            <span class="text-xs text-gray-500 dark:text-gray-400">Alertas</span>
                            <div class="text-sm font-bold text-warning" id="headerAlertCount">0</div>
                        </div>
                        <div class="h-6 w-px bg-gray-300 dark:bg-gray-500"></div>
                        <div class="text-center">
                            <span class="text-xs text-gray-500 dark:text-gray-400">Taxa OK</span>
                            <div class="text-sm font-bold text-success" id="headerComplianceRate">100%</div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Notifications -->
                    <div class="relative">
                        <button id="alertBtn" onclick="showNotificationsPanel()" class="relative p-3 text-gray-600 dark:text-gray-300 hover:text-primary hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-all duration-200 group">
                            <i class="fas fa-bell text-xl group-hover:animate-pulse"></i>
                            <span id="alertBadge" class="absolute -top-1 -right-1 bg-danger text-white text-xs rounded-full h-6 w-6 flex items-center justify-center hidden animate-bounce">0</span>
                        </button>
                        
                        <!-- Enhanced Notifications Panel -->
                        <div id="notificationsPanel" class="hidden absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 z-50 animate-slide-up">
                            <div class="p-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-primary/10 to-secondary/10">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                        <i class="fas fa-bell text-primary mr-2"></i>Notificações
                                    </h3>
                                    <span class="text-xs bg-primary/20 text-primary px-2 py-1 rounded-full" id="notificationCount">0</span>
                                </div>
                            </div>
                            <div class="max-h-96 overflow-y-auto custom-scrollbar">
                                <div id="notificationsList" class="p-4 space-y-3">
                                    <!-- Notifications will be populated here -->
                                </div>
                            </div>
                            <div class="p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700">
                                <div class="flex justify-between">
                                    <button onclick="markAllAsRead()" class="text-sm text-primary hover:text-primary/80 transition-colors">Marcar todas como lidas</button>
                                    <button onclick="clearAllNotifications()" class="text-sm text-gray-500 hover:text-red-500 transition-colors">Limpar tudo</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Settings -->
                    <button onclick="showSettingsModal()" class="p-3 text-gray-600 dark:text-gray-300 hover:text-primary hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-all duration-200 group" title="Configurações">
                        <i class="fas fa-cog text-xl group-hover:rotate-90 transition-transform duration-300"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Enhanced Navigation -->
    <nav class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 sticky top-16 z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center">
                <div class="flex space-x-8 overflow-x-auto">
                    <button onclick="showTab('dashboard')" class="nav-btn active-tab py-4 px-1 border-b-2 border-primary text-primary font-medium whitespace-nowrap transition-all duration-200 hover:bg-primary/5">
                        <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                    </button>
                    <button onclick="showTab('vehicles')" class="nav-btn py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap transition-all duration-200 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <i class="fas fa-truck mr-2"></i>Veículos
                    </button>
                    <button onclick="showTab('drivers')" class="nav-btn py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap transition-all duration-200 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <i class="fas fa-users mr-2"></i>Motoristas
                    </button>
                    <button onclick="showTab('speed-tracking')" class="nav-btn py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap transition-all duration-200 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <i class="fas fa-tachometer-alt mr-2"></i>Monitoramento
                    </button>
                    <button onclick="showTab('reports')" class="nav-btn py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap transition-all duration-200 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <i class="fas fa-chart-bar mr-2"></i>Relatórios
                    </button>
                    <button onclick="showTab('backup')" class="nav-btn py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap transition-all duration-200 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <i class="fas fa-database mr-2"></i>Backup & Dados
                    </button>
                </div>
                
                <!-- Enhanced Data Management Actions -->
                <div class="flex items-center space-x-2">
                    <div class="flex items-center space-x-2 px-3 py-1 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div id="saveStatus" class="w-3 h-3 rounded-full bg-green-500 animate-pulse" title="Sistema ativo"></div>
                        <span class="text-xs text-gray-500 dark:text-gray-400" id="saveStatusText">Dados salvos</span>
                    </div>
                    <button onclick="forceSave()" class="p-2 text-gray-600 dark:text-gray-300 hover:text-success hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-all duration-200 group" title="Salvar Agora">
                        <i class="fas fa-save text-sm group-hover:scale-110 transition-transform"></i>
                    </button>
                    <button onclick="showImportModal()" class="p-2 text-gray-600 dark:text-gray-300 hover:text-info hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-all duration-200 group" title="Importar Dados">
                        <i class="fas fa-upload text-sm group-hover:scale-110 transition-transform"></i>
                    </button>
                    <button onclick="exportAllData()" class="p-2 text-gray-600 dark:text-gray-300 hover:text-primary hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-all duration-200 group" title="Exportar Tudo">
                        <i class="fas fa-download text-sm group-hover:scale-110 transition-transform"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Enhanced Toast Notification -->
    <div id="toast" class="fixed top-20 right-4 z-50 hidden">
        <div class="bg-white dark:bg-gray-800 border-l-4 rounded-lg shadow-xl p-4 max-w-sm transform transition-all duration-300 animate-slide-up">
            <div class="flex items-center">
                <i id="toastIcon" class="text-xl mr-3"></i>
                <div class="flex-1">
                    <p id="toastTitle" class="font-medium text-gray-900 dark:text-white"></p>
                    <p id="toastMessage" class="text-sm text-gray-600 dark:text-gray-300"></p>
                </div>
                <button onclick="hideToast()" class="ml-auto text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="toastProgress" class="absolute bottom-0 left-0 h-1 bg-primary rounded-b-lg transition-all duration-5000"></div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <!-- Enhanced Dashboard Tab -->
        <div id="dashboard" class="tab-content animate-fade-in">
            <!-- Enhanced Quick Actions -->
            <div class="mb-6">
                <div class="flex flex-wrap gap-3">
                    <button onclick="showSpeedEntryModal()" class="bg-gradient-to-r from-primary to-primary/80 text-white px-4 py-2 rounded-lg hover:from-primary/90 hover:to-primary/70 transition-all duration-200 flex items-center shadow-md hover:shadow-lg transform hover:scale-105">
                        <i class="fas fa-plus mr-2"></i>Registrar Velocidade
                    </button>
                    <button onclick="showAddVehicleModal()" class="bg-gradient-to-r from-success to-success/80 text-white px-4 py-2 rounded-lg hover:from-success/90 hover:to-success/70 transition-all duration-200 flex items-center shadow-md hover:shadow-lg transform hover:scale-105">
                        <i class="fas fa-truck mr-2"></i>Novo Veículo
                    </button>
                    <button onclick="showAddDriverModal()" class="bg-gradient-to-r from-info to-info/80 text-white px-4 py-2 rounded-lg hover:from-info/90 hover:to-info/70 transition-all duration-200 flex items-center shadow-md hover:shadow-lg transform hover:scale-105">
                        <i class="fas fa-user-plus mr-2"></i>Novo Motorista
                    </button>
                    <button onclick="generateQuickReport()" class="bg-gradient-to-r from-secondary to-secondary/80 text-white px-4 py-2 rounded-lg hover:from-secondary/90 hover:to-secondary/70 transition-all duration-200 flex items-center shadow-md hover:shadow-lg transform hover:scale-105">
                        <i class="fas fa-chart-line mr-2"></i>Relatório Rápido
                    </button>
                    <button onclick="exportToExcel()" class="bg-gradient-to-r from-warning to-warning/80 text-white px-4 py-2 rounded-lg hover:from-warning/90 hover:to-warning/70 transition-all duration-200 flex items-center shadow-md hover:shadow-lg transform hover:scale-105">
                        <i class="fas fa-file-excel mr-2"></i>Exportar Excel
                    </button>
                </div>
            </div>

            <!-- Enhanced Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 border-l-4 border-primary hover:shadow-xl transition-all duration-300 transform hover:scale-105 animate-fade-in">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 p-3 bg-gradient-to-br from-primary/20 to-primary/10 rounded-lg">
                            <i class="fas fa-truck text-primary text-3xl"></i>
                        </div>
                        <div class="ml-4 flex-1">
                            <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Total de Veículos</p>
                            <p class="text-3xl font-bold text-gray-900 dark:text-white" id="totalVehicles">0</p>
                            <div class="flex items-center mt-2">
                                <span class="text-xs text-success flex items-center">
                                    <i class="fas fa-arrow-up mr-1"></i>Frota ativa
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 border-l-4 border-success hover:shadow-xl transition-all duration-300 transform hover:scale-105 animate-fade-in">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 p-3 bg-gradient-to-br from-success/20 to-success/10 rounded-lg">
                            <i class="fas fa-user-check text-success text-3xl"></i>
                        </div>
                        <div class="ml-4 flex-1">
                            <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Motoristas Ativos</p>
                            <p class="text-3xl font-bold text-gray-900 dark:text-white" id="activeDrivers">0</p>
                            <div class="flex items-center mt-2">
                                <span class="text-xs text-success flex items-center">
                                    <i class="fas fa-check-circle mr-1"></i>Em serviço
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 border-l-4 border-warning hover:shadow-xl transition-all duration-300 transform hover:scale-105 animate-fade-in">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 p-3 bg-gradient-to-br from-warning/20 to-warning/10 rounded-lg">
                            <i class="fas fa-exclamation-triangle text-warning text-3xl"></i>
                        </div>
                        <div class="ml-4 flex-1">
                            <p class="text-sm font-medium text-gray-600 dark:text-gray-400">A Vencer</p>
                            <p class="text-3xl font-bold text-gray-900 dark:text-white" id="expiringSoon">0</p>
                            <div class="flex items-center mt-2">
                                <span class="text-xs text-warning flex items-center">
                                    <i class="fas fa-clock mr-1"></i>Próximos 30 dias
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 border-l-4 border-danger hover:shadow-xl transition-all duration-300 transform hover:scale-105 animate-fade-in">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 p-3 bg-gradient-to-br from-danger/20 to-danger/10 rounded-lg">
                            <i class="fas fa-times-circle text-danger text-3xl"></i>
                        </div>
                        <div class="ml-4 flex-1">
                            <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Vencidos</p>
                            <p class="text-3xl font-bold text-gray-900 dark:text-white" id="expired">0</p>
                            <div class="flex items-center mt-2">
                                <span class="text-xs text-danger flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i>Requer atenção
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Performance Metrics -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                            <i class="fas fa-chart-line text-primary mr-2"></i>Performance Geral
                        </h4>
                        <span class="text-xs bg-primary/20 text-primary px-2 py-1 rounded-full" id="performanceScore">0%</span>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600 dark:text-gray-400">Taxa de Conformidade</span>
                            <span class="text-sm font-medium text-green-600" id="complianceRate">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                            <div id="complianceBar" class="bg-gradient-to-r from-green-400 to-green-600 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600 dark:text-gray-400">Documentos em Dia</span>
                            <span class="text-sm font-medium text-blue-600" id="docsUpToDate">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                            <div id="docsBar" class="bg-gradient-to-r from-blue-400 to-blue-600 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                            <i class="fas fa-tachometer-alt text-warning mr-2"></i>Velocidade Média
                        </h4>
                        <span class="text-xs bg-warning/20 text-warning px-2 py-1 rounded-full" id="avgSpeedToday">0 km/h</span>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-gray-900 dark:text-white mb-2" id="fleetAvgSpeed">0</div>
                        <p class="text-sm text-gray-600 dark:text-gray-400">km/h média da frota</p>
                        <div class="mt-4 flex justify-center">
                            <div class="w-24 h-24 rounded-full border-4 border-gray-200 dark:border-gray-700 relative">
                                <div id="speedGauge" class="absolute inset-0 rounded-full border-4 border-transparent transition-all duration-1000" style="background: conic-gradient(from 0deg, #10B981 0%, #F59E0B 70%, #EF4444 90%)"></div>
                                <div class="absolute inset-2 bg-white dark:bg-gray-800 rounded-full flex items-center justify-center">
                                    <span class="text-xs font-bold text-gray-700 dark:text-gray-300" id="speedPercentage">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                            <i class="fas fa-calendar-alt text-info mr-2"></i>Hoje
                        </h4>
                        <span class="text-xs bg-info/20 text-info px-2 py-1 rounded-full" id="todayDate"></span>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600 dark:text-gray-400">Registros</span>
                            <span class="text-lg font-bold text-gray-900 dark:text-white" id="todayRecords">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600 dark:text-gray-400">Infrações</span>
                            <span class="text-lg font-bold text-red-600" id="todayViolations">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600 dark:text-gray-400">Motoristas Ativos</span>
                            <span class="text-lg font-bold text-green-600" id="todayActiveDrivers">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-chart-pie text-primary mr-2"></i>Status dos Documentos
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="refreshDocumentsChart()" class="text-gray-400 hover:text-primary transition-colors p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button onclick="toggleChartType('documents')" class="text-gray-400 hover:text-primary transition-colors p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                                    <i class="fas fa-exchange-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="chart-container" style="position: relative; height: 250px;">
                            <canvas id="documentsChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-tachometer-alt text-primary mr-2"></i>Infrações por Período
                            </h3>
                            <div class="flex space-x-2">
                                <select id="violationsChartPeriod" onchange="refreshViolationsChart()" class="text-xs bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-2 py-1">
                                    <option value="7">7 dias</option>
                                    <option value="30">30 dias</option>
                                    <option value="90">90 dias</option>
                                </select>
                                <button onclick="refreshViolationsChart()" class="text-gray-400 hover:text-primary transition-colors p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="chart-container" style="position: relative; height: 250px;">
                            <canvas id="violationsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Recent Activity and Alerts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-warning/10 to-danger/10">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-bell text-warning mr-2 animate-pulse"></i>Alertas Prioritários
                            </h3>
                            <div class="flex items-center space-x-2">
                                <span class="text-xs bg-warning/20 text-warning px-2 py-1 rounded-full" id="alertsCount">0</span>
                                <button onclick="refreshAlerts()" class="text-gray-400 hover:text-warning transition-colors p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 max-h-80 overflow-y-auto custom-scrollbar">
                        <div id="alertsList" class="space-y-4">
                            <!-- Alerts will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-info/10 to-primary/10">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-clock text-info mr-2"></i>Atividade Recente
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="clearRecentActivity()" class="text-xs text-gray-400 hover:text-danger transition-colors px-2 py-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Limpar</button>
                                <button onclick="refreshRecentActivity()" class="text-gray-400 hover:text-info transition-colors p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 max-h-80 overflow-y-auto custom-scrollbar">
                        <div id="recentActivity" class="space-y-4">
                            <!-- Recent activity will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Vehicles Tab -->
        <div id="vehicles" class="tab-content hidden animate-fade-in">
            <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-primary/5 to-secondary/5">
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-truck text-primary mr-2"></i>Gestão de Veículos
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Controle completo da frota</p>
                        </div>
                        
                        <div class="flex flex-wrap gap-2">
                            <!-- Enhanced Search -->
                            <div class="relative">
                                <input type="text" id="vehicleSearch" placeholder="Buscar veículo..." class="pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white w-64 focus:ring-2 focus:ring-primary focus:border-primary transition-all" oninput="debouncedVehicleSearch()">
                                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                <div id="vehicleSearchLoading" class="absolute right-3 top-3 hidden">
                                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-primary"></div>
                                </div>
                            </div>
                            
                            <!-- Enhanced Filters -->
                            <select id="vehicleStatusFilter" onchange="filterVehicles()" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="">Todos os status</option>
                                <option value="Em dia">Em dia</option>
                                <option value="A vencer">A vencer</option>
                                <option value="Vencido">Vencido</option>
                            </select>
                            
                            <select id="vehicleYearFilter" onchange="filterVehicles()" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="">Todos os anos</option>
                            </select>
                            
                            <button onclick="showAddVehicleModal()" class="bg-gradient-to-r from-primary to-primary/80 text-white px-4 py-2 rounded-lg hover:from-primary/90 hover:to-primary/70 transition-all duration-200 flex items-center shadow-md hover:shadow-lg transform hover:scale-105">
                                <i class="fas fa-plus mr-2"></i>Adicionar Veículo
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- Enhanced Vehicle Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800 hover:shadow-md transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">Total</p>
                                    <p class="text-2xl font-bold text-blue-700 dark:text-blue-300" id="vehicleStatsTotal">0</p>
                                </div>
                                <div class="p-2 bg-blue-200 dark:bg-blue-800 rounded-lg">
                                    <i class="fas fa-truck text-blue-600 dark:text-blue-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-4 rounded-lg border border-green-200 dark:border-green-800 hover:shadow-md transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-green-600 dark:text-green-400 font-medium">Em dia</p>
                                    <p class="text-2xl font-bold text-green-700 dark:text-green-300" id="vehicleStatsActive">0</p>
                                </div>
                                <div class="p-2 bg-green-200 dark:bg-green-800 rounded-lg">
                                    <i class="fas fa-check-circle text-green-600 dark:text-green-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800 hover:shadow-md transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-yellow-600 dark:text-yellow-400 font-medium">Alertas</p>
                                    <p class="text-2xl font-bold text-yellow-700 dark:text-yellow-300" id="vehicleStatsAlerts">0</p>
                                </div>
                                <div class="p-2 bg-yellow-200 dark:bg-yellow-800 rounded-lg">
                                    <i class="fas fa-exclamation-triangle text-yellow-600 dark:text-yellow-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800 hover:shadow-md transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-purple-600 dark:text-purple-400 font-medium">Idade Média</p>
                                    <p class="text-2xl font-bold text-purple-700 dark:text-purple-300" id="vehicleStatsAvgAge">0</p>
                                </div>
                                <div class="p-2 bg-purple-200 dark:bg-purple-800 rounded-lg">
                                    <i class="fas fa-calendar text-purple-600 dark:text-purple-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Table -->
                    <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="sortVehicles('plate')">
                                        Placa <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="sortVehicles('model')">
                                        Modelo <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Motorista</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="sortVehicles('tachographExpiry')">
                                        Tacógrafo <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Inspeção</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="vehiclesTable" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Vehicle data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Enhanced Pagination -->
                    <div id="vehiclesPagination" class="mt-6 flex items-center justify-between bg-gray-50 dark:bg-gray-700 px-4 py-3 rounded-lg">
                        <div class="flex-1 flex justify-between sm:hidden">
                            <button onclick="previousVehiclesPage()" id="vehiclesPrevBtnMobile" class="relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                Anterior
                            </button>
                            <button onclick="nextVehiclesPage()" id="vehiclesNextBtnMobile" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                Próximo
                            </button>
                        </div>
                        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                            <div>
                                <p class="text-sm text-gray-700 dark:text-gray-300">
                                    Mostrando <span class="font-medium" id="vehiclesShowingStart">0</span> a <span class="font-medium" id="vehiclesShowingEnd">0</span> de <span class="font-medium" id="vehiclesTotal">0</span> veículos
                                </p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="previousVehiclesPage()" id="vehiclesPrevBtn" class="relative inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fas fa-chevron-left mr-1"></i>Anterior
                                </button>
                                <button onclick="nextVehiclesPage()" id="vehiclesNextBtn" class="ml-3 relative inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    Próximo<i class="fas fa-chevron-right ml-1"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Drivers Tab -->
        <div id="drivers" class="tab-content hidden animate-fade-in">
            <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-info/5 to-success/5">
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-users text-info mr-2"></i>Gestão de Motoristas
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Controle de CNH e qualificações</p>
                        </div>
                        
                        <div class="flex flex-wrap gap-2">
                            <!-- Enhanced Search -->
                            <div class="relative">
                                <input type="text" id="driverSearch" placeholder="Buscar motorista..." class="pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white w-64 focus:ring-2 focus:ring-info focus:border-info transition-all" oninput="debouncedDriverSearch()">
                                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                <div id="driverSearchLoading" class="absolute right-3 top-3 hidden">
                                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-info"></div>
                                </div>
                            </div>
                            
                            <select id="driverCategoryFilter" onchange="filterDrivers()" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-info focus:border-info transition-all">
                                <option value="">Todas as categorias</option>
                                <option value="A">A - Motocicleta</option>
                                <option value="B">B - Carro</option>
                                <option value="C">C - Caminhão</option>
                                <option value="D">D - Ônibus</option>
                                <option value="E">E - Carreta</option>
                            </select>
                            
                            <select id="driverStatusFilter" onchange="filterDrivers()" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-info focus:border-info transition-all">
                                <option value="">Todos os status</option>
                                <option value="Ativo">Ativo</option>
                                <option value="Inativo">Inativo</option>
                                <option value="CNH Vencida">CNH Vencida</option>
                            </select>
                            
                            <button onclick="showAddDriverModal()" class="bg-gradient-to-r from-info to-info/80 text-white px-4 py-2 rounded-lg hover:from-info/90 hover:to-info/70 transition-all duration-200 flex items-center shadow-md hover:shadow-lg transform hover:scale-105">
                                <i class="fas fa-plus mr-2"></i>Adicionar Motorista
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- Enhanced Driver Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800 hover:shadow-md transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">Total</p>
                                    <p class="text-2xl font-bold text-blue-700 dark:text-blue-300" id="driverStatsTotal">0</p>
                                </div>
                                <div class="p-2 bg-blue-200 dark:bg-blue-800 rounded-lg">
                                    <i class="fas fa-users text-blue-600 dark:text-blue-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-4 rounded-lg border border-green-200 dark:border-green-800 hover:shadow-md transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-green-600 dark:text-green-400 font-medium">Ativos</p>
                                    <p class="text-2xl font-bold text-green-700 dark:text-green-300" id="driverStatsActive">0</p>
                                </div>
                                <div class="p-2 bg-green-200 dark:bg-green-800 rounded-lg">
                                    <i class="fas fa-user-check text-green-600 dark:text-green-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800 hover:shadow-md transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-yellow-600 dark:text-yellow-400 font-medium">CNH a vencer</p>
                                    <p class="text-2xl font-bold text-yellow-700 dark:text-yellow-300" id="driverStatsExpiring">0</p>
                                </div>
                                <div class="p-2 bg-yellow-200 dark:bg-yellow-800 rounded-lg">
                                    <i class="fas fa-clock text-yellow-600 dark:text-yellow-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 p-4 rounded-lg border border-red-200 dark:border-red-800 hover:shadow-md transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-red-600 dark:text-red-400 font-medium">CNH vencida</p>
                                    <p class="text-2xl font-bold text-red-700 dark:text-red-300" id="driverStatsExpired">0</p>
                                </div>
                                <div class="p-2 bg-red-200 dark:bg-red-800 rounded-lg">
                                    <i class="fas fa-times-circle text-red-600 dark:text-red-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Table -->
                    <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="sortDrivers('name')">
                                        Nome <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">CNH</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Categoria</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="sortDrivers('licenseExpiry')">
                                        Vencimento CNH <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Veículo Atual</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="driversTable" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Driver data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Enhanced Pagination -->
                    <div id="driversPagination" class="mt-6 flex items-center justify-between bg-gray-50 dark:bg-gray-700 px-4 py-3 rounded-lg">
                        <div class="flex-1 flex justify-between sm:hidden">
                            <button onclick="previousDriversPage()" id="driversPrevBtnMobile" class="relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                Anterior
                            </button>
                            <button onclick="nextDriversPage()" id="driversNextBtnMobile" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                Próximo
                            </button>
                        </div>
                        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                            <div>
                                <p class="text-sm text-gray-700 dark:text-gray-300">
                                    Mostrando <span class="font-medium" id="driversShowingStart">0</span> a <span class="font-medium" id="driversShowingEnd">0</span> de <span class="font-medium" id="driversTotal">0</span> motoristas
                                </p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="previousDriversPage()" id="driversPrevBtn" class="relative inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fas fa-chevron-left mr-1"></i>Anterior
                                </button>
                                <button onclick="nextDriversPage()" id="driversNextBtn" class="ml-3 relative inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    Próximo<i class="fas fa-chevron-right ml-1"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Speed Tracking Tab -->
        <div id="speed-tracking" class="tab-content hidden animate-fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- Enhanced Speed Entry Form -->
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                        <i class="fas fa-plus-circle text-primary mr-2"></i>Registrar Velocidade
                    </h3>
                    <form id="speedEntryForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Motorista <span class="text-red-500">*</span></label>
                            <select id="speedDriverSelect" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                                <option value="">Selecione um motorista</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Velocidade (km/h) <span class="text-red-500">*</span></label>
                            <div class="relative">
                                <input type="number" id="speedValue" min="0" max="200" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="Ex: 85" required oninput="updateSpeedIndicator()">
                                <div id="speedIndicatorMain" class="absolute right-3 top-3 w-3 h-3 rounded-full bg-gray-400 transition-all duration-300"></div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Limite da Via (km/h) <span class="text-red-500">*</span></label>
                            <select id="speedLimit" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required onchange="updateSpeedIndicator()">
                                <option value="">Selecione o limite</option>
                                <option value="30">30 km/h - Área Escolar</option>
                                <option value="40">40 km/h - Área Comercial</option>
                                <option value="50">50 km/h - Via Urbana</option>
                                <option value="60">60 km/h - Via Arterial</option>
                                <option value="70">70 km/h - Via Expressa</option>
                                <option value="80">80 km/h - Rodovia</option>
                                <option value="90">90 km/h - Rodovia</option>
                                <option value="100">100 km/h - Rodovia</option>
                                <option value="110">110 km/h - Rodovia</option>
                                <option value="120">120 km/h - Rodovia</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data/Hora <span class="text-red-500">*</span></label>
                            <input type="datetime-local" id="speedDateTime" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Localização <span class="text-red-500">*</span></label>
                            <input type="text" id="speedLocation" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="Ex: BR-101, KM 245" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Observações</label>
                            <textarea id="speedObservations" rows="3" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="Observações adicionais..."></textarea>
                        </div>
                        
                        <!-- Enhanced Speed Preview -->
                        <div id="speedStatusPreview" class="hidden bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 p-4 rounded-lg border border-gray-200 dark:border-gray-600">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600 dark:text-gray-400">Status previsto:</span>
                                <span id="speedStatusText" class="text-sm font-medium"></span>
                            </div>
                            <div class="mt-2">
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                    <div id="speedPreviewBar" class="h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="w-full bg-gradient-to-r from-primary to-primary/80 text-white px-4 py-3 rounded-lg hover:from-primary/90 hover:to-primary/70 transition-all duration-200 font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                            <i class="fas fa-save mr-2"></i>Registrar Velocidade
                        </button>
                    </form>
                </div>

                <!-- Enhanced Speed Status and Alerts -->
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-tachometer-alt text-primary mr-2"></i>Status Atual da Frota
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="refreshSpeedStatus()" class="text-gray-400 hover:text-primary transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button onclick="toggleSpeedView()" class="text-gray-400 hover:text-primary transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">
                                    <i class="fas fa-th-list" id="speedViewIcon"></i>
                                </button>
                            </div>
                        </div>
                        <div id="currentSpeedStatus" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Current speed status will be populated here -->
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-exclamation-triangle text-warning mr-2 animate-pulse"></i>Alertas de Velocidade
                            </h3>
                            <div class="flex items-center space-x-2">
                                <span class="text-xs bg-warning/20 text-warning px-2 py-1 rounded-full animate-bounce" id="speedAlertsCount">0</span>
                                <button onclick="refreshSpeedAlerts()" class="text-gray-400 hover:text-warning transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div id="speedAlerts" class="space-y-3 max-h-64 overflow-y-auto custom-scrollbar">
                            <!-- Speed alerts will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Speed History -->
            <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-warning/5 to-danger/5">
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-history text-warning mr-2"></i>Histórico de Velocidade
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Registros de velocidade da frota</p>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <input type="date" id="speedHistoryDate" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white text-sm focus:ring-2 focus:ring-warning focus:border-warning transition-all" onchange="filterSpeedHistory()">
                            <select id="speedHistoryDriver" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white text-sm focus:ring-2 focus:ring-warning focus:border-warning transition-all" onchange="filterSpeedHistory()">
                                <option value="">Todos os motoristas</option>
                            </select>
                            <select id="speedHistoryStatus" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white text-sm focus:ring-2 focus:ring-warning focus:border-warning transition-all" onchange="filterSpeedHistory()">
                                <option value="">Todos os status</option>
                                <option value="Normal">Normal</option>
                                <option value="Infração">Infração</option>
                                <option value="Infração Grave">Infração Grave</option>
                            </select>
                            <button onclick="exportSpeedData()" class="px-3 py-2 bg-gradient-to-r from-success to-success/80 text-white rounded-lg hover:from-success/90 hover:to-success/70 transition-all duration-200 text-sm">
                                <i class="fas fa-file-excel mr-1"></i>Excel
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="sortSpeedRecords('datetime')">
                                        Data/Hora <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Motorista</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Veículo</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="sortSpeedRecords('speed')">
                                        Velocidade <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Limite</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Localização</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="speedHistoryTable" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Speed history will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Enhanced Pagination -->
                    <div id="speedPagination" class="mt-6 flex items-center justify-between bg-gray-50 dark:bg-gray-700 px-4 py-3 rounded-lg">
                        <div class="flex-1 flex justify-between sm:hidden">
                            <button onclick="previousSpeedPage()" id="speedPrevBtnMobile" class="relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                Anterior
                            </button>
                            <button onclick="nextSpeedPage()" id="speedNextBtnMobile" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                Próximo
                            </button>
                        </div>
                        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                            <div>
                                <p class="text-sm text-gray-700 dark:text-gray-300">
                                    Mostrando <span class="font-medium" id="speedShowingStart">0</span> a <span class="font-medium" id="speedShowingEnd">0</span> de <span class="font-medium" id="speedTotal">0</span> registros
                                </p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="previousSpeedPage()" id="speedPrevBtn" class="relative inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fas fa-chevron-left mr-1"></i>Anterior
                                </button>
                                <button onclick="nextSpeedPage()" id="speedNextBtn" class="ml-3 relative inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    Próximo<i class="fas fa-chevron-right ml-1"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Reports Tab -->
        <div id="reports" class="tab-content hidden animate-fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Enhanced Report Filters -->
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                        <i class="fas fa-filter text-primary mr-2"></i>Filtros de Relatório
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Período</label>
                            <select id="reportPeriod" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" onchange="toggleCustomDateRange()">
                                <option value="7">Últimos 7 dias</option>
                                <option value="30">Últimos 30 dias</option>
                                <option value="90">Últimos 3 meses</option>
                                <option value="365">Último ano</option>
                                <option value="custom">Período personalizado</option>
                            </select>
                        </div>
                        
                        <div id="customDateRange" class="space-y-2 hidden">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Data Inicial</label>
                            <input type="date" id="reportStartDate" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Data Final</label>
                            <input type="date" id="reportEndDate" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Relatório</label>
                            <select id="reportType" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="general">Relatório Geral</option>
                                <option value="speed">Infrações de Velocidade</option>
                                <option value="maintenance">Manutenção e Vencimentos</option>
                                <option value="drivers">Performance dos Motoristas</option>
                                <option value="vehicles">Status dos Veículos</option>
                                <option value="compliance">Relatório de Conformidade</option>
                                <option value="executive">Resumo Executivo</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Motorista</label>
                            <select id="reportDriver" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="">Todos os motoristas</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Formato</label>
                            <select id="reportFormat" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="html">HTML (Visualização)</option>
                                <option value="excel">Excel (Download)</option>
                                <option value="pdf">PDF (Download)</option>
                            </select>
                        </div>
                        
                        <div class="space-y-2">
                            <button onclick="generateReport()" class="w-full bg-gradient-to-r from-primary to-primary/80 text-white px-4 py-3 rounded-lg hover:from-primary/90 hover:to-primary/70 transition-all duration-200 font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                                <i class="fas fa-chart-bar mr-2"></i>Gerar Relatório
                            </button>
                            
                            <button onclick="exportReport()" class="w-full bg-gradient-to-r from-success to-success/80 text-white px-4 py-3 rounded-lg hover:from-success/90 hover:to-success/70 transition-all duration-200 font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                                <i class="fas fa-file-excel mr-2"></i>Exportar Relatório
                            </button>
                            
                            <button onclick="scheduleReport()" class="w-full bg-gradient-to-r from-info to-info/80 text-white px-4 py-3 rounded-lg hover:from-info/90 hover:to-info/70 transition-all duration-200 font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                                <i class="fas fa-clock mr-2"></i>Agendar Relatório
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Enhanced Report Content -->
                <div class="lg:col-span-3 bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-primary/5 to-secondary/5">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-chart-line text-primary mr-2"></i>Relatório Gerado
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="printReport()" class="text-gray-400 hover:text-primary transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full" title="Imprimir">
                                    <i class="fas fa-print"></i>
                                </button>
                                <button onclick="shareReport()" class="text-gray-400 hover:text-primary transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full" title="Compartilhar">
                                    <i class="fas fa-share-alt"></i>
                                </button>
                                <button onclick="refreshReport()" class="text-gray-400 hover:text-primary transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full" title="Atualizar">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="reportContent" class="min-h-96">
                            <div class="flex items-center justify-center h-64 text-gray-500 dark:text-gray-400">
                                <div class="text-center">
                                    <i class="fas fa-chart-line text-6xl mb-4 text-gray-300 dark:text-gray-600"></i>
                                    <p class="text-lg font-medium">Relatórios Avançados</p>
                                    <p class="text-sm mt-1">Selecione os filtros e clique em "Gerar Relatório" para visualizar os dados</p>
                                    <div class="mt-4 flex justify-center space-x-2">
                                        <div class="w-2 h-2 bg-primary rounded-full animate-bounce"></div>
                                        <div class="w-2 h-2 bg-primary rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                        <div class="w-2 h-2 bg-primary rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Backup & Data Tab -->
        <div id="backup" class="tab-content hidden animate-fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Enhanced Data Status -->
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                        <i class="fas fa-server text-success mr-2 animate-pulse"></i>Sistema de Dados
                    </h3>
                    <div class="space-y-4">
                        <div class="bg-gradient-to-r from-success/10 to-info/10 p-4 rounded-lg border border-success/20">
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-sm font-medium text-gray-900 dark:text-white">Status do Sistema</span>
                                <span class="text-xs px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-200 rounded-full flex items-center">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mr-1 animate-pulse"></div>Ativo
                                </span>
                            </div>
                            <div class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
                                <div class="flex justify-between">
                                    <span>Total de registros:</span>
                                    <span id="totalRecords" class="font-medium">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Última atualização:</span>
                                    <span id="lastUpdate" class="font-medium">Agora</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Tamanho dos dados:</span>
                                    <span id="dataSize" class="font-medium">0 KB</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Integridade:</span>
                                    <span class="font-medium text-green-600">100%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            <button onclick="forceSave()" class="w-full bg-gradient-to-r from-success to-success/80 text-white px-4 py-3 rounded-lg hover:from-success/90 hover:to-success/70 transition-all duration-200 font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                                <i class="fas fa-save mr-2"></i>Salvar Agora
                            </button>
                            
                            <button onclick="downloadAllData()" class="w-full bg-gradient-to-r from-primary to-primary/80 text-white px-4 py-3 rounded-lg hover:from-primary/90 hover:to-primary/70 transition-all duration-200 font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                                <i class="fas fa-download mr-2"></i>Backup Completo
                            </button>
                            
                            <button onclick="validateData()" class="w-full bg-gradient-to-r from-info to-info/80 text-white px-4 py-3 rounded-lg hover:from-info/90 hover:to-info/70 transition-all duration-200 font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                                <i class="fas fa-check-double mr-2"></i>Validar Dados
                            </button>
                            
                            <button onclick="clearAllData()" class="w-full bg-gradient-to-r from-danger to-danger/80 text-white px-4 py-3 rounded-lg hover:from-danger/90 hover:to-danger/70 transition-all duration-200 font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                                <i class="fas fa-trash mr-2"></i>Limpar Todos os Dados
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Import -->
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                        <i class="fas fa-upload text-info mr-2"></i>Importar Dados
                    </h3>
                    <div class="space-y-4">
                        <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center hover:border-info transition-all duration-300 cursor-pointer relative" id="dropZone">
                            <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-3"></i>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Arraste o arquivo ou clique para selecionar</p>
                            <input type="file" id="importFileInput" accept=".json,.csv,.xlsx" class="hidden" onchange="handleFileSelect(event)">
                            <button onclick="document.getElementById('importFileInput').click()" class="bg-gradient-to-r from-info to-info/80 text-white px-4 py-2 rounded-lg hover:from-info/90 hover:to-info/70 transition-all duration-200 text-sm">
                                <i class="fas fa-file-upload mr-2"></i>Selecionar Arquivo
                            </button>
                            <div id="filePreview" class="hidden mt-3 text-left bg-gray-50 dark:bg-gray-700 p-3 rounded">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <i class="fas fa-file text-blue-500 mr-2"></i>
                                        <span id="fileName" class="text-sm font-medium"></span>
                                    </div>
                                    <button onclick="clearFileSelection()" class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="mt-2">
                                    <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                        <div id="uploadProgress" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3">
                            <div class="flex">
                                <i class="fas fa-info-circle text-blue-500 mr-2 mt-0.5"></i>
                                <div class="text-xs text-blue-800 dark:text-blue-200">
                                    <p class="font-medium">Formatos suportados:</p>
                                    <ul class="list-disc list-inside mt-1">
                                        <li>JSON (backup do sistema)</li>
                                        <li>CSV (dados tabulares)</li>
                                        <li>XLSX (planilhas Excel)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-2">
                            <button onclick="importSampleData()" class="flex-1 bg-gradient-to-r from-warning to-warning/80 text-white px-4 py-3 rounded-lg hover:from-warning/90 hover:to-warning/70 transition-all duration-200 font-medium shadow-md hover:shadow-lg transform hover:scale-105 text-sm">
                                <i class="fas fa-database mr-2"></i>Dados de Exemplo
                            </button>
                            <button onclick="showImportGuide()" class="px-4 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-200 text-sm">
                                <i class="fas fa-question-circle"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Export -->
                <div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                        <i class="fas fa-download text-primary mr-2"></i>Exportar Dados
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Exportação</label>
                            <select id="exportType" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="all">Todos os Dados</option>
                                <option value="vehicles">Apenas Veículos</option>
                                <option value="drivers">Apenas Motoristas</option>
                                <option value="speed">Apenas Velocidade</option>
                                <option value="activities">Apenas Atividades</option>
                                <option value="reports">Relatórios</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Formato</label>
                            <select id="exportFormat" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="json">JSON (Backup Completo)</option>
                                <option value="csv">CSV (Planilha)</option>
                                <option value="xlsx">XLSX (Excel)</option>
                                <option value="pdf">PDF (Relatório)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Período (para dados temporais)</label>
                            <select id="exportPeriod" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="all">Todos os períodos</option>
                                <option value="7">Últimos 7 dias</option>
                                <option value="30">Últimos 30 dias</option>
                                <option value="90">Últimos 3 meses</option>
                                <option value="365">Último ano</option>
                            </select>
                        </div>
                        
                        <div class="space-y-2">
                            <button onclick="exportSelectedData()" class="w-full bg-gradient-to-r from-primary to-primary/80 text-white px-4 py-3 rounded-lg hover:from-primary/90 hover:to-primary/70 transition-all duration-200 font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                                <i class="fas fa-download mr-2"></i>Exportar Dados
                            </button>
                            
                            <button onclick="scheduleBackup()" class="w-full bg-gradient-to-r from-secondary to-secondary/80 text-white px-4 py-3 rounded-lg hover:from-secondary/90 hover:to-secondary/70 transition-all duration-200 font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                                <i class="fas fa-clock mr-2"></i>Agendar Backup
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Data Statistics -->
            <div class="mt-6 bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-chart-bar text-primary mr-2"></i>Estatísticas dos Dados
                    </h3>
                    <div class="flex space-x-2">
                        <button onclick="refreshDataStats()" class="text-gray-400 hover:text-primary transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button onclick="analyzeDataTrends()" class="text-gray-400 hover:text-primary transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">
                            <i class="fas fa-chart-line"></i>
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg border border-blue-200 dark:border-blue-800 hover:shadow-md transition-all duration-200">
                        <i class="fas fa-truck text-blue-500 text-2xl mb-2"></i>
                        <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">Veículos</p>
                        <p class="text-2xl font-bold text-blue-700 dark:text-blue-300" id="statsVehicles">0</p>
                        <p class="text-xs text-blue-500 dark:text-blue-400 mt-1" id="vehiclesGrowth">+0% este mês</p>
                    </div>
                    <div class="text-center p-4 bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg border border-green-200 dark:border-green-800 hover:shadow-md transition-all duration-200">
                        <i class="fas fa-users text-green-500 text-2xl mb-2"></i>
                        <p class="text-sm text-green-600 dark:text-green-400 font-medium">Motoristas</p>
                        <p class="text-2xl font-bold text-green-700 dark:text-green-300" id="statsDrivers">0</p>
                        <p class="text-xs text-green-500 dark:text-green-400 mt-1" id="driversGrowth">+0% este mês</p>
                    </div>
                    <div class="text-center p-4 bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 rounded-lg border border-yellow-200 dark:border-yellow-800 hover:shadow-md transition-all duration-200">
                        <i class="fas fa-tachometer-alt text-yellow-500 text-2xl mb-2"></i>
                        <p class="text-sm text-yellow-600 dark:text-yellow-400 font-medium">Registros de Velocidade</p>
                        <p class="text-2xl font-bold text-yellow-700 dark:text-yellow-300" id="statsSpeed">0</p>
                        <p class="text-xs text-yellow-500 dark:text-yellow-400 mt-1" id="speedGrowth">+0% este mês</p>
                    </div>
                    <div class="text-center p-4 bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg border border-purple-200 dark:border-purple-800 hover:shadow-md transition-all duration-200">
                        <i class="fas fa-clock text-purple-500 text-2xl mb-2"></i>
                        <p class="text-sm text-purple-600 dark:text-purple-400 font-medium">Atividades</p>
                        <p class="text-2xl font-bold text-purple-700 dark:text-purple-300" id="statsActivities">0</p>
                        <p class="text-xs text-purple-500 dark:text-purple-400 mt-1" id="activitiesGrowth">+0% este mês</p>
                    </div>
                </div>
                
                <!-- Data Health Indicators -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Qualidade dos Dados</h4>
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs text-gray-500 dark:text-gray-400">Completude</span>
                            <span class="text-sm font-bold text-green-600" id="dataCompleteness">98%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                            <div class="bg-green-500 h-2 rounded-full transition-all duration-1000" id="completenessBar" style="width: 98%"></div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Consistência</h4>
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs text-gray-500 dark:text-gray-400">Validação</span>
                            <span class="text-sm font-bold text-blue-600" id="dataConsistency">95%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                            <div class="bg-blue-500 h-2 rounded-full transition-all duration-1000" id="consistencyBar" style="width: 95%"></div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Atualização</h4>
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs text-gray-500 dark:text-gray-400">Recente</span>
                            <span class="text-sm font-bold text-purple-600" id="dataFreshness">100%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                            <div class="bg-purple-500 h-2 rounded-full transition-all duration-1000" id="freshnessBar" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Enhanced Modals -->
    <!-- Speed Entry Modal -->
    <div id="speedEntryModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-lg w-full max-h-screen overflow-y-auto transform transition-all duration-300 scale-95 opacity-0" id="speedEntryModalContent">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                <i class="fas fa-tachometer-alt text-primary mr-2"></i>Registro Rápido de Velocidade
            </h3>
            <form id="quickSpeedForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Motorista <span class="text-red-500">*</span></label>
                        <select id="quickSpeedDriver" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                            <option value="">Selecione</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Velocidade (km/h) <span class="text-red-500">*</span></label>
                        <div class="relative">
                            <input type="number" id="quickSpeedValue" min="0" max="200" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required oninput="updateSpeedIndicator()">
                            <div id="speedIndicator" class="absolute right-3 top-3 w-3 h-3 rounded-full bg-gray-400 transition-all duration-300"></div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Limite (km/h) <span class="text-red-500">*</span></label>
                        <select id="quickSpeedLimit" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required onchange="updateSpeedIndicator()">
                            <option value="30">30 km/h</option>
                            <option value="40">40 km/h</option>
                            <option value="50">50 km/h</option>
                            <option value="60">60 km/h</option>
                            <option value="80" selected>80 km/h</option>
                            <option value="100">100 km/h</option>
                            <option value="110">110 km/h</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data/Hora <span class="text-red-500">*</span></label>
                        <input type="datetime-local" id="quickSpeedDateTime" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Localização <span class="text-red-500">*</span></label>
                    <input type="text" id="quickSpeedLocation" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="Ex: BR-101, KM 245" required>
                </div>
                
                <div id="speedStatusPreview" class="hidden bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 p-3 rounded-lg border border-gray-200 dark:border-gray-600">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600 dark:text-gray-400">Status previsto:</span>
                        <span id="speedStatusText" class="text-sm font-medium"></span>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeSpeedEntryModal()" class="px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">Cancelar</button>
                    <button type="submit" class="px-6 py-3 bg-gradient-to-r from-primary to-primary/80 text-white hover:from-primary/90 hover:to-primary/70 rounded-lg transition-all duration-200 font-medium transform hover:scale-105">
                        <i class="fas fa-save mr-2"></i>Registrar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Vehicle Modal -->
    <div id="addVehicleModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-lg w-full max-h-screen overflow-y-auto transform transition-all duration-300 scale-95 opacity-0" id="addVehicleModalContent">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                <i class="fas fa-truck text-primary mr-2"></i>Adicionar Veículo
            </h3>
            <form id="addVehicleForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Placa <span class="text-red-500">*</span></label>
                        <input type="text" id="vehiclePlate" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="ABC-1234" required oninput="validatePlate(this)">
                        <div id="plateValidation" class="text-xs mt-1 hidden"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Modelo <span class="text-red-500">*</span></label>
                        <input type="text" id="vehicleModel" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="Ex: Volvo FH 540" required>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ano</label>
                        <input type="number" id="vehicleYear" min="1990" max="2030" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="2023">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cor</label>
                        <input type="text" id="vehicleColor" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="Branco">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Motorista</label>
                    <select id="vehicleDriver" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                        <option value="">Selecione um motorista</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Vencimento do Tacógrafo <span class="text-red-500">*</span></label>
                        <input type="date" id="vehicleTachograph" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data da Inspeção <span class="text-red-500">*</span></label>
                        <input type="date" id="vehicleInspection" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeAddVehicleModal()" class="px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">Cancelar</button>
                    <button type="submit" class="px-6 py-3 bg-gradient-to-r from-primary to-primary/80 text-white hover:from-primary/90 hover:to-primary/70 rounded-lg transition-all duration-200 font-medium transform hover:scale-105">
                        <i class="fas fa-save mr-2"></i>Adicionar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Driver Modal -->
    <div id="addDriverModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-lg w-full max-h-screen overflow-y-auto transform transition-all duration-300 scale-95 opacity-0" id="addDriverModalContent">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                <i class="fas fa-user-plus text-primary mr-2"></i>Adicionar Motorista
            </h3>
            <form id="addDriverForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nome Completo <span class="text-red-500">*</span></label>
                    <input type="text" id="driverName" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="Nome completo" required>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">CNH <span class="text-red-500">*</span></label>
                        <input type="text" id="driverLicense" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="12345678901" required oninput="validateCNH(this)">
                        <div id="cnhValidation" class="text-xs mt-1 hidden"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Categoria <span class="text-red-500">*</span></label>
                        <select id="driverCategory" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                            <option value="">Selecione</option>
                            <option value="A">A - Motocicleta</option>
                            <option value="B">B - Carro</option>
                            <option value="C">C - Caminhão</option>
                            <option value="D">D - Ônibus</option>
                            <option value="E">E - Carreta</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data de Nascimento</label>
                        <input type="date" id="driverBirthDate" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Vencimento da CNH <span class="text-red-500">*</span></label>
                        <input type="date" id="driverLicenseExpiry" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Telefone</label>
                        <input type="tel" id="driverPhone" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="(11) 99999-9999" oninput="formatPhone(this)">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                        <input type="email" id="driverEmail" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="email@exemplo.com">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeAddDriverModal()" class="px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">Cancelar</button>
                    <button type="submit" class="px-6 py-3 bg-gradient-to-r from-primary to-primary/80 text-white hover:from-primary/90 hover:to-primary/70 rounded-lg transition-all duration-200 font-medium transform hover:scale-105">
                        <i class="fas fa-save mr-2"></i>Adicionar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Vehicle Modal -->
    <div id="editVehicleModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-lg w-full max-h-screen overflow-y-auto transform transition-all duration-300 scale-95 opacity-0" id="editVehicleModalContent">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                <i class="fas fa-edit text-primary mr-2"></i>Editar Veículo
            </h3>
            <form id="editVehicleForm" class="space-y-4">
                <input type="hidden" id="editVehicleId">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Placa <span class="text-red-500">*</span></label>
                        <input type="text" id="editVehiclePlate" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required oninput="validatePlate(this)">
                        <div id="editPlateValidation" class="text-xs mt-1 hidden"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Modelo <span class="text-red-500">*</span></label>
                        <input type="text" id="editVehicleModel" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ano</label>
                        <input type="number" id="editVehicleYear" min="1990" max="2030" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cor</label>
                        <input type="text" id="editVehicleColor" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Motorista</label>
                    <select id="editVehicleDriver" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                        <option value="">Selecione um motorista</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Vencimento do Tacógrafo <span class="text-red-500">*</span></label>
                        <input type="date" id="editVehicleTachograph" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data da Inspeção <span class="text-red-500">*</span></label>
                        <input type="date" id="editVehicleInspection" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeEditVehicleModal()" class="px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">Cancelar</button>
                    <button type="submit" class="px-6 py-3 bg-gradient-to-r from-primary to-primary/80 text-white hover:from-primary/90 hover:to-primary/70 rounded-lg transition-all duration-200 font-medium transform hover:scale-105">
                        <i class="fas fa-save mr-2"></i>Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Driver Modal -->
    <div id="editDriverModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-lg w-full max-h-screen overflow-y-auto transform transition-all duration-300 scale-95 opacity-0" id="editDriverModalContent">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                <i class="fas fa-edit text-primary mr-2"></i>Editar Motorista
            </h3>
            <form id="editDriverForm" class="space-y-4">
                <input type="hidden" id="editDriverId">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nome Completo <span class="text-red-500">*</span></label>
                    <input type="text" id="editDriverName" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">CNH <span class="text-red-500">*</span></label>
                        <input type="text" id="editDriverLicense" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required oninput="validateCNH(this)">
                        <div id="editCnhValidation" class="text-xs mt-1 hidden"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Categoria <span class="text-red-500">*</span></label>
                        <select id="editDriverCategory" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                            <option value="A">A - Motocicleta</option>
                            <option value="B">B - Carro</option>
                            <option value="C">C - Caminhão</option>
                            <option value="D">D - Ônibus</option>
                            <option value="E">E - Carreta</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data de Nascimento</label>
                        <input type="date" id="editDriverBirthDate" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Vencimento da CNH <span class="text-red-500">*</span></label>
                        <input type="date" id="editDriverLicenseExpiry" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" required>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Telefone</label>
                        <input type="tel" id="editDriverPhone" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="(11) 99999-9999" oninput="formatPhone(this)">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                        <input type="email" id="editDriverEmail" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="email@exemplo.com">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeEditDriverModal()" class="px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">Cancelar</button>
                    <button type="submit" class="px-6 py-3 bg-gradient-to-r from-primary to-primary/80 text-white hover:from-primary/90 hover:to-primary/70 rounded-lg transition-all duration-200 font-medium transform hover:scale-105">
                        <i class="fas fa-save mr-2"></i>Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Enhanced Import Modal -->
    <div id="importModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-lg w-full max-h-screen overflow-y-auto transform transition-all duration-300 scale-95 opacity-0" id="importModalContent">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                <i class="fas fa-upload text-info mr-2"></i>Importar Dados
            </h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Importação</label>
                    <select id="importType" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-info focus:border-info transition-all">
                        <option value="auto">Detectar automaticamente</option>
                        <option value="vehicles">Apenas Veículos</option>
                        <option value="drivers">Apenas Motoristas</option>
                        <option value="speed">Apenas Velocidade</option>
                        <option value="full">Backup Completo</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Selecionar Arquivo</label>
                    <input type="file" id="modalImportFile" accept=".json,.csv,.xlsx" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-info focus:border-info transition-all">
                </div>
                
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="importOverwrite" class="rounded border-gray-300 dark:border-gray-600 text-info focus:ring-info">
                    <label for="importOverwrite" class="text-sm text-gray-700 dark:text-gray-300">Sobrescrever dados existentes</label>
                </div>
                
                <div class="bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3">
                    <div class="flex">
                        <i class="fas fa-info-circle text-blue-500 mr-2 mt-0.5"></i>
                        <div class="text-xs text-blue-800 dark:text-blue-200">
                            <p class="font-medium">Formatos suportados:</p>
                            <ul class="list-disc list-inside mt-1">
                                <li>JSON (backup do sistema)</li>
                                <li>CSV (dados tabulares)</li>
                                <li>XLSX (planilhas Excel)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button onclick="closeImportModal()" class="px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">Cancelar</button>
                <button onclick="processImport()" class="px-6 py-3 bg-gradient-to-r from-info to-info/80 text-white hover:from-info/90 hover:to-info/70 rounded-lg transition-all duration-200 font-medium transform hover:scale-105">
                    <i class="fas fa-upload mr-2"></i>Importar
                </button>
            </div>
        </div>
    </div>

    <!-- Enhanced Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto transform transition-all duration-300 scale-95 opacity-0" id="settingsModalContent">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                <i class="fas fa-cog text-primary mr-2"></i>Configurações do Sistema
            </h3>
            
            <div class="space-y-6">
                <!-- General Settings -->
                <div class="border-b border-gray-200 dark:border-gray-700 pb-4">
                    <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                        <i class="fas fa-sliders-h text-primary mr-2"></i>Configurações Gerais
                    </h4>
                    <div class="space-y-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="autoSaveEnabled" checked class="mr-3 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary">
                            <span class="text-gray-700 dark:text-gray-300">Ativar salvamento automático</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" id="notificationsEnabled" checked class="mr-3 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary">
                            <span class="text-gray-700 dark:text-gray-300">Ativar notificações</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" id="soundNotifications" class="mr-3 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary">
                            <span class="text-gray-700 dark:text-gray-300">Notificações sonoras</span>
                        </label>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Itens por página</label>
                                <select id="itemsPerPage" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                    <option value="10">10 itens</option>
                                    <option value="25" selected>25 itens</option>
                                    <option value="50">50 itens</option>
                                    <option value="100">100 itens</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tema da interface</label>
                                <select id="themeSelector" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                    <option value="auto">Automático</option>
                                    <option value="light">Claro</option>
                                    <option value="dark">Escuro</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Alert Settings -->
                <div class="border-b border-gray-200 dark:border-gray-700 pb-4">
                    <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                        <i class="fas fa-bell text-warning mr-2"></i>Configurações de Alertas
                    </h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Antecedência de vencimentos (dias)</label>
                            <input type="number" id="alertDays" min="1" max="90" value="30" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded text-base dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                        </div>
                        
                        <label class="flex items-center">
                            <input type="checkbox" id="emailAlerts" class="mr-3 rounded border-gray-300 dark:border-gray-600 text-warning focus:ring-warning">
                            <span class="text-gray-700 dark:text-gray-300">Alertas por email</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" id="speedAlerts" checked class="mr-3 rounded border-gray-300 dark:border-gray-600 text-warning focus:ring-warning">
                            <span class="text-gray-700 dark:text-gray-300">Alertas de velocidade</span>
                        </label>
                    </div>
                </div>
                
                <!-- System Info -->
                <div>
                    <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                        <i class="fas fa-info-circle text-info mr-2"></i>Informações do Sistema
                    </h4>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <p><strong>Versão:</strong> FleetControl Pro v3.0</p>
                                <p><strong>Última atualização:</strong> <span id="lastSystemUpdate">Agora</span></p>
                            </div>
                            <div>
                                <p><strong>Navegador:</strong> <span id="browserInfo">-</span></p>
                                <p><strong>Resolução:</strong> <span id="screenResolution">-</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button onclick="resetSettings()" class="px-6 py-3 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all duration-200">Restaurar Padrão</button>
                <button onclick="closeSettingsModal()" class="px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">Cancelar</button>
                <button onclick="saveSettings()" class="px-6 py-3 bg-gradient-to-r from-primary to-primary/80 text-white hover:from-primary/90 hover:to-primary/70 rounded-lg transition-all duration-200 font-medium transform hover:scale-105">
                    <i class="fas fa-save mr-2"></i>Salvar Configurações
                </button>
            </div>
        </div>
    </div>

    <style>
        /* Enhanced animations and styles */
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        /* Enhanced tab content animation */
        .tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        /* Enhanced navigation active state */
        .nav-btn.active-tab {
            border-bottom-color: #5D5CDE !important;
            color: #5D5CDE !important;
            background: linear-gradient(to bottom, rgba(93, 92, 222, 0.05), transparent);
        }
        
        /* Enhanced custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, rgba(156, 163, 175, 0.5), rgba(156, 163, 175, 0.8));
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, rgba(156, 163, 175, 0.8), rgba(156, 163, 175, 1));
        }

        /* Enhanced modal animations */
        .modal-show {
            animation: scaleIn 0.3s ease-out;
        }

        /* Enhanced loading states */
        .loading-pulse {
            animation: pulse 2s infinite;
        }

        /* Enhanced hover effects */
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        /* Enhanced gradient backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, rgba(93, 92, 222, 0.1), rgba(255, 107, 53, 0.1));
        }

        /* Enhanced button styles */
        .btn-enhanced {
            background: linear-gradient(135deg, #5D5CDE, #4F46E5);
            transition: all 0.3s ease;
        }

        .btn-enhanced:hover {
            background: linear-gradient(135deg, #4F46E5, #5D5CDE);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(93, 92, 222, 0.4);
        }

        /* Enhanced table styles */
        .table-enhanced tbody tr:hover {
            background: linear-gradient(90deg, rgba(93, 92, 222, 0.05), rgba(93, 92, 222, 0.02));
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        /* Enhanced notification styles */
        .notification-bounce {
            animation: bounce 0.6s ease-in-out;
        }

        /* Enhanced progress bars */
        .progress-bar {
            background: linear-gradient(90deg, #10B981, #059669);
            transition: width 0.5s ease-in-out;
        }

        /* Enhanced input focus states */
        .input-enhanced:focus {
            border-color: #5D5CDE;
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.1);
            transform: scale(1.02);
            transition: all 0.2s ease;
        }

        /* Enhanced card hover effects */
        .card-enhanced:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        /* Enhanced responsive design */
        @media (max-width: 768px) {
            .mobile-enhanced {
                padding: 1rem;
                margin: 0.5rem;
            }
            
            .table-enhanced {
                font-size: 0.875rem;
            }
            
            .btn-enhanced {
                padding: 0.75rem 1.5rem;
                font-size: 0.875rem;
            }
        }

        /* Dark mode enhancements */
        .dark .gradient-bg {
            background: linear-gradient(135deg, rgba(93, 92, 222, 0.2), rgba(255, 107, 53, 0.2));
        }

        /* Enhanced loading overlay */
        .loading-overlay {
            backdrop-filter: blur(4px);
            background: rgba(0, 0, 0, 0.6);
        }

        /* Enhanced success/error states */
        .success-state {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            border-left: 4px solid #10B981;
        }

        .error-state {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            border-left: 4px solid #EF4444;
        }

        .warning-state {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1));
            border-left: 4px solid #F59E0B;
        }
    </style>

    <script>
        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // ========================================
        // ENHANCED APPLICATION DATA MANAGER V3.0 WITH PERSISTENCE
        // ========================================
        
        class FleetControlAppV3 {
            constructor() {
                // Initialize data structures
                this.storageKey = 'FleetControlProV3_Data';
                this.settingsKey = 'FleetControlProV3_Settings';
                
                // Default data structure
                this.defaultData = {
                    vehicles: [],
                    drivers: [],
                    speedRecords: [],
                    recentActivities: [],
                    notifications: [],
                    version: '3.0',
                    created: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                };

                // Default settings
                this.defaultSettings = {
                    autoSave: true,
                    notificationsEnabled: true,
                    soundNotifications: false,
                    emailAlerts: false,
                    speedAlerts: true,
                    itemsPerPage: 25,
                    alertDays: 30,
                    theme: 'auto'
                };
                
                // Load data from localStorage or use defaults
                this.data = this.loadData();
                this.settings = this.loadSettings();
                
                // Enhanced pagination and filtering states
                this.pagination = {
                    vehicles: { currentPage: 1, itemsPerPage: this.settings.itemsPerPage },
                    drivers: { currentPage: 1, itemsPerPage: this.settings.itemsPerPage },
                    speedRecords: { currentPage: 1, itemsPerPage: this.settings.itemsPerPage }
                };
                
                this.filters = {
                    vehicles: { search: '', status: '', year: '' },
                    drivers: { search: '', category: '', status: '' },
                    speedRecords: { date: '', driver: '', status: '' }
                };
                
                this.sorting = {
                    vehicles: { field: 'plate', direction: 'asc' },
                    drivers: { field: 'name', direction: 'asc' },
                    speedRecords: { field: 'datetime', direction: 'desc' }
                };
                
                this.charts = {
                    documents: null,
                    violations: null
                };

                // Enhanced debounce functions
                this.debounceTimers = {};
                
                this.init();
            }

            // ========================================
            // ENHANCED PERSISTENCE METHODS
            // ========================================

            loadData() {
                try {
                    const savedData = localStorage.getItem(this.storageKey);
                    if (savedData) {
                        const parsedData = JSON.parse(savedData);
                        // Validate and merge with default structure
                        return {
                            ...this.defaultData,
                            ...parsedData,
                            lastLoaded: new Date().toISOString()
                        };
                    }
                } catch (error) {
                    console.warn('Erro ao carregar dados salvos:', error);
                    this.addNotification('Aviso', 'Erro ao carregar dados salvos. Iniciando com dados limpos.', 'warning');
                }
                return { ...this.defaultData };
            }

            loadSettings() {
                try {
                    const savedSettings = localStorage.getItem(this.settingsKey);
                    if (savedSettings) {
                        const parsedSettings = JSON.parse(savedSettings);
                        return { ...this.defaultSettings, ...parsedSettings };
                    }
                } catch (error) {
                    console.warn('Erro ao carregar configurações:', error);
                }
                return { ...this.defaultSettings };
            }

            saveData() {
                try {
                    this.data.lastModified = new Date().toISOString();
                    localStorage.setItem(this.storageKey, JSON.stringify(this.data));
                    this.updateSaveStatus('success');
                    return true;
                } catch (error) {
                    console.error('Erro ao salvar dados:', error);
                    this.updateSaveStatus('error');
                    this.addNotification('Erro', 'Falha ao salvar dados automaticamente', 'error');
                    return false;
                }
            }

            saveSettings() {
                try {
                    localStorage.setItem(this.settingsKey, JSON.stringify(this.settings));
                    return true;
                } catch (error) {
                    console.error('Erro ao salvar configurações:', error);
                    return false;
                }
            }

            updateSaveStatus(status) {
                const saveStatus = document.getElementById('saveStatus');
                const saveStatusText = document.getElementById('saveStatusText');
                
                if (saveStatus && saveStatusText) {
                    if (status === 'success') {
                        saveStatus.className = 'w-3 h-3 rounded-full bg-green-500';
                        saveStatusText.textContent = 'Dados salvos';
                    } else if (status === 'error') {
                        saveStatus.className = 'w-3 h-3 rounded-full bg-red-500 animate-pulse';
                        saveStatusText.textContent = 'Erro ao salvar';
                    } else {
                        saveStatus.className = 'w-3 h-3 rounded-full bg-yellow-500 animate-pulse';
                        saveStatusText.textContent = 'Salvando...';
                    }
                }
            }

            // Auto-save when data changes
            autoSave() {
                if (this.settings.autoSave) {
                    this.updateSaveStatus('saving');
                    setTimeout(() => {
                        this.saveData();
                    }, 500);
                }
            }

            init() {
                // Initialize the enhanced application
                this.addActivity('Sistema FleetControl Pro v3.0 inicializado', 'fa-rocket', 'success');
                
                // Check if this is first run
                if (this.data.vehicles.length === 0 && this.data.drivers.length === 0) {
                    this.addNotification('Bem-vindo!', 'FleetControl Pro v3.0 iniciado. Dados serão salvos automaticamente.', 'info');
                } else {
                    this.addNotification('Sistema Carregado', `Dados carregados: ${this.data.vehicles.length} veículos, ${this.data.drivers.length} motoristas`, 'success');
                }
                
                this.populateSystemInfo();
                this.autoSave();
            }

            // ========================================
            // ENHANCED CRUD OPERATIONS WITH AUTO-SAVE
            // ========================================

            // Enhanced Vehicles CRUD
            addVehicle(vehicleData) {
                // Validate data
                if (!this.validateVehicleData(vehicleData)) {
                    throw new Error('Dados do veículo inválidos');
                }

                const newVehicle = {
                    ...vehicleData,
                    id: Math.max(...this.data.vehicles.map(v => v.id), 0) + 1,
                    status: this.calculateVehicleStatus(vehicleData.tachographExpiry, vehicleData.inspectionDate),
                    fuelType: vehicleData.fuelType || 'Diesel',
                    lastMaintenance: vehicleData.lastMaintenance || new Date().toISOString().split('T')[0],
                    createdAt: new Date().toISOString()
                };
                
                this.data.vehicles.push(newVehicle);
                this.addActivity(`Novo veículo adicionado: ${newVehicle.plate}`, 'fa-truck', 'success');
                this.addNotification('Veículo adicionado', `Veículo ${newVehicle.plate} foi adicionado com sucesso`, 'success');
                this.autoSave();
                return newVehicle;
            }

            updateVehicle(id, updates) {
                const vehicleIndex = this.data.vehicles.findIndex(v => v.id === id);
                if (vehicleIndex === -1) return false;
                
                // Validate updates
                if (!this.validateVehicleData(updates, true)) {
                    throw new Error('Dados de atualização inválidos');
                }
                
                Object.assign(this.data.vehicles[vehicleIndex], updates);
                this.data.vehicles[vehicleIndex].status = this.calculateVehicleStatus(
                    this.data.vehicles[vehicleIndex].tachographExpiry,
                    this.data.vehicles[vehicleIndex].inspectionDate
                );
                this.data.vehicles[vehicleIndex].updatedAt = new Date().toISOString();
                
                this.addActivity(`Veículo atualizado: ${this.data.vehicles[vehicleIndex].plate}`, 'fa-edit', 'info');
                this.autoSave();
                return this.data.vehicles[vehicleIndex];
            }

            removeVehicle(id) {
                const vehicleIndex = this.data.vehicles.findIndex(v => v.id === id);
                if (vehicleIndex === -1) return false;
                
                const vehicle = this.data.vehicles[vehicleIndex];
                this.data.vehicles.splice(vehicleIndex, 1);
                this.addActivity(`Veículo removido: ${vehicle.plate}`, 'fa-trash', 'danger');
                this.addNotification('Veículo removido', `Veículo ${vehicle.plate} foi removido`, 'warning');
                this.autoSave();
                return true;
            }

            // Enhanced Drivers CRUD
            addDriver(driverData) {
                // Validate data
                if (!this.validateDriverData(driverData)) {
                    throw new Error('Dados do motorista inválidos');
                }

                const newDriver = {
                    ...driverData,
                    id: Math.max(...this.data.drivers.map(d => d.id), 0) + 1,
                    status: 'Ativo',
                    currentVehicle: '',
                    hireDate: driverData.hireDate || new Date().toISOString().split('T')[0],
                    createdAt: new Date().toISOString()
                };
                
                this.data.drivers.push(newDriver);
                this.addActivity(`Novo motorista adicionado: ${newDriver.name}`, 'fa-user-plus', 'info');
                this.addNotification('Motorista adicionado', `Motorista ${newDriver.name} foi adicionado com sucesso`, 'success');
                this.autoSave();
                return newDriver;
            }

            updateDriver(id, updates) {
                const driverIndex = this.data.drivers.findIndex(d => d.id === id);
                if (driverIndex === -1) return false;
                
                // Validate updates
                if (!this.validateDriverData(updates, true)) {
                    throw new Error('Dados de atualização inválidos');
                }
                
                Object.assign(this.data.drivers[driverIndex], updates);
                this.data.drivers[driverIndex].updatedAt = new Date().toISOString();
                this.addActivity(`Motorista atualizado: ${this.data.drivers[driverIndex].name}`, 'fa-edit', 'info');
                this.autoSave();
                return this.data.drivers[driverIndex];
            }

            removeDriver(id) {
                const driverIndex = this.data.drivers.findIndex(d => d.id === id);
                if (driverIndex === -1) return false;
                
                const driver = this.data.drivers[driverIndex];
                this.data.drivers.splice(driverIndex, 1);
                this.addActivity(`Motorista removido: ${driver.name}`, 'fa-trash', 'danger');
                this.addNotification('Motorista removido', `Motorista ${driver.name} foi removido`, 'warning');
                this.autoSave();
                return true;
            }

            // Enhanced Speed Records CRUD
            addSpeedRecord(recordData) {
                // Validate data
                if (!this.validateSpeedRecord(recordData)) {
                    throw new Error('Dados de velocidade inválidos');
                }

                const newRecord = {
                    ...recordData,
                    id: Math.max(...this.data.speedRecords.map(r => r.id), 0) + 1,
                    weather: recordData.weather || 'N/A',
                    trafficCondition: recordData.trafficCondition || 'N/A',
                    createdAt: new Date().toISOString()
                };
                
                this.data.speedRecords.push(newRecord);
                this.addActivity(`Velocidade registrada: ${newRecord.driverName} - ${newRecord.speed}km/h`, 'fa-tachometer-alt', 'primary');
                
                if (newRecord.status !== 'Normal') {
                    const alertLevel = newRecord.status.includes('Grave') ? 'error' : 'warning';
                    this.addNotification('Infração de velocidade', 
                        `${newRecord.driverName} - ${newRecord.speed}km/h (Limite: ${newRecord.speedLimit}km/h)`, 
                        alertLevel);
                }
                
                this.autoSave();
                return newRecord;
            }

            removeSpeedRecord(id) {
                const recordIndex = this.data.speedRecords.findIndex(r => r.id === id);
                if (recordIndex === -1) return false;
                
                this.data.speedRecords.splice(recordIndex, 1);
                this.addActivity('Registro de velocidade removido', 'fa-trash', 'danger');
                this.autoSave();
                return true;
            }

            // ========================================
            // ENHANCED VALIDATION FUNCTIONS
            // ========================================

            validateVehicleData(data, isUpdate = false) {
                if (!isUpdate) {
                    if (!data.plate || !data.model || !data.tachographExpiry || !data.inspectionDate) {
                        return false;
                    }
                }
                
                // Validate plate format (Brazilian pattern)
                if (data.plate && !this.validatePlateFormat(data.plate)) {
                    return false;
                }
                
                // Check for duplicate plates
                if (data.plate) {
                    const existingVehicle = this.data.vehicles.find(v => 
                        v.plate === data.plate && (!isUpdate || v.id !== data.id)
                    );
                    if (existingVehicle) {
                        throw new Error('Já existe um veículo com esta placa');
                    }
                }
                
                return true;
            }

            validateDriverData(data, isUpdate = false) {
                if (!isUpdate) {
                    if (!data.name || !data.license || !data.category || !data.licenseExpiry) {
                        return false;
                    }
                }
                
                // Validate CNH format
                if (data.license && !this.validateCNHFormat(data.license)) {
                    return false;
                }
                
                // Check for duplicate CNH
                if (data.license) {
                    const existingDriver = this.data.drivers.find(d => 
                        d.license === data.license && (!isUpdate || d.id !== data.id)
                    );
                    if (existingDriver) {
                        throw new Error('Já existe um motorista com esta CNH');
                    }
                }
                
                // Validate email if provided
                if (data.email && !this.validateEmail(data.email)) {
                    return false;
                }
                
                return true;
            }

            validateSpeedRecord(data) {
                if (!data.driverId || !data.speed || !data.speedLimit || !data.datetime || !data.location) {
                    return false;
                }
                
                // Validate speed values
                if (data.speed < 0 || data.speed > 200 || data.speedLimit < 0 || data.speedLimit > 200) {
                    return false;
                }
                
                // Validate driver exists
                const driver = this.data.drivers.find(d => d.id === data.driverId);
                if (!driver) {
                    return false;
                }
                
                return true;
            }

            validatePlateFormat(plate) {
                // Brazilian plate format: ABC-1234 or ABC1D234 (Mercosul)
                const oldFormat = /^[A-Z]{3}-\d{4}$/;
                const newFormat = /^[A-Z]{3}\d[A-Z]\d{3}$/;
                return oldFormat.test(plate) || newFormat.test(plate);
            }

            validateCNHFormat(cnh) {
                // CNH should be 11 digits
                return /^\d{11}$/.test(cnh.replace(/\D/g, ''));
            }

            validateEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }

            // ========================================
            // ENHANCED UTILITY FUNCTIONS
            // ========================================

            calculateVehicleStatus(tachographExpiry, inspectionDate) {
                const today = new Date();
                const alertDays = this.settings.alertDays;
                const alertDate = new Date(today.getTime() + (alertDays * 24 * 60 * 60 * 1000));
                
                const tachographDate = new Date(tachographExpiry);
                const inspectionExpiry = new Date(new Date(inspectionDate).getTime() + (2 * 365 * 24 * 60 * 60 * 1000));
                
                if (tachographDate < today || inspectionExpiry < today) {
                    return 'Vencido';
                } else if (tachographDate < alertDate || inspectionExpiry < alertDate) {
                    return 'A vencer';
                } else {
                    return 'Em dia';
                }
            }

            addActivity(message, icon, color) {
                this.data.recentActivities.unshift({
                    id: Date.now(),
                    message,
                    icon,
                    color,
                    datetime: new Date().toISOString()
                });
                
                // Keep only last 100 activities
                if (this.data.recentActivities.length > 100) {
                    this.data.recentActivities = this.data.recentActivities.slice(0, 100);
                }
                
                // Auto-save activities
                this.autoSave();
            }

            addNotification(title, message, type = 'info') {
                if (!this.settings.notificationsEnabled) return;

                const notification = {
                    id: Date.now(),
                    title,
                    message,
                    type,
                    datetime: new Date().toISOString(),
                    read: false
                };

                this.data.notifications.unshift(notification);
                
                // Keep only last 50 notifications
                if (this.data.notifications.length > 50) {
                    this.data.notifications = this.data.notifications.slice(0, 50);
                }
                
                // Play sound if enabled
                if (this.settings.soundNotifications) {
                    this.playNotificationSound(type);
                }
                
                this.updateNotificationCounter();
                this.autoSave();
            }

            playNotificationSound(type) {
                // Create audio context for notifications
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    // Different frequencies for different notification types
                    const frequencies = {
                        success: 523.25,  // C5
                        warning: 440.00,  // A4
                        error: 329.63,    // E4
                        info: 659.25      // E5
                    };
                    
                    oscillator.frequency.setValueAtTime(frequencies[type] || frequencies.info, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                } catch (error) {
                    console.log('Audio context not supported');
                }
            }

            markAllNotificationsAsRead() {
                this.data.notifications.forEach(n => n.read = true);
                this.updateNotificationCounter();
                this.autoSave();
            }

            clearAllNotifications() {
                this.data.notifications = [];
                this.updateNotificationCounter();
                this.autoSave();
            }

            updateNotificationCounter() {
                const badge = document.getElementById('alertBadge');
                const count = document.getElementById('notificationCount');
                const unreadCount = this.data.notifications.filter(n => !n.read).length;
                
                if (badge) {
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount;
                        badge.classList.remove('hidden');
                        badge.classList.add('animate-bounce');
                    } else {
                        badge.classList.add('hidden');
                        badge.classList.remove('animate-bounce');
                    }
                }

                if (count) {
                    count.textContent = unreadCount;
                }
            }

            getStats() {
                return {
                    totalVehicles: this.data.vehicles.length,
                    totalDrivers: this.data.drivers.length,
                    totalSpeedRecords: this.data.speedRecords.length,
                    totalActivities: this.data.recentActivities.length,
                    unreadNotifications: this.data.notifications.filter(n => !n.read).length
                };
            }

            // ========================================
            // ENHANCED SEARCH AND FILTER FUNCTIONS
            // ========================================

            searchVehicles(searchTerm = '', statusFilter = '', yearFilter = '') {
                let filtered = this.data.vehicles;
                
                if (searchTerm) {
                    const term = searchTerm.toLowerCase();
                    filtered = filtered.filter(vehicle =>
                        vehicle.plate.toLowerCase().includes(term) ||
                        vehicle.model.toLowerCase().includes(term) ||
                        (vehicle.driver && vehicle.driver.toLowerCase().includes(term)) ||
                        (vehicle.color && vehicle.color.toLowerCase().includes(term))
                    );
                }
                
                if (statusFilter) {
                    filtered = filtered.filter(vehicle => vehicle.status === statusFilter);
                }

                if (yearFilter) {
                    filtered = filtered.filter(vehicle => vehicle.year && vehicle.year.toString() === yearFilter);
                }
                
                return this.applySorting(filtered, 'vehicles');
            }

            searchDrivers(searchTerm = '', categoryFilter = '', statusFilter = '') {
                let filtered = this.data.drivers;
                
                if (searchTerm) {
                    const term = searchTerm.toLowerCase();
                    filtered = filtered.filter(driver =>
                        driver.name.toLowerCase().includes(term) ||
                        driver.license.includes(term) ||
                        (driver.email && driver.email.toLowerCase().includes(term)) ||
                        (driver.phone && driver.phone.includes(term))
                    );
                }
                
                if (categoryFilter) {
                    filtered = filtered.filter(driver => driver.category === categoryFilter);
                }

                if (statusFilter) {
                    filtered = filtered.filter(driver => driver.status === statusFilter);
                }
                
                return this.applySorting(filtered, 'drivers');
            }

            searchSpeedRecords(filters = {}) {
                let filtered = this.data.speedRecords;
                
                if (filters.date) {
                    filtered = filtered.filter(record => 
                        record.datetime.startsWith(filters.date)
                    );
                }
                
                if (filters.driver) {
                    filtered = filtered.filter(record => 
                        record.driverId === parseInt(filters.driver)
                    );
                }
                
                if (filters.status) {
                    filtered = filtered.filter(record => record.status === filters.status);
                }
                
                return this.applySorting(filtered, 'speedRecords');
            }

            applySorting(data, type) {
                const sorting = this.sorting[type];
                if (!sorting || !sorting.field) return data;

                return data.sort((a, b) => {
                    let aVal = a[sorting.field];
                    let bVal = b[sorting.field];

                    // Handle different data types
                    if (sorting.field === 'datetime' || sorting.field.includes('Date') || sorting.field.includes('Expiry')) {
                        aVal = new Date(aVal);
                        bVal = new Date(bVal);
                    } else if (typeof aVal === 'string') {
                        aVal = aVal.toLowerCase();
                        bVal = bVal.toLowerCase();
                    }

                    if (aVal < bVal) return sorting.direction === 'asc' ? -1 : 1;
                    if (aVal > bVal) return sorting.direction === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            // ========================================
            // ENHANCED DATA EXPORT/IMPORT FUNCTIONS
            // ========================================

            exportData(type = 'all', format = 'json', period = 'all') {
                let dataToExport = {};
                let filename = '';
                
                // Filter by period for temporal data
                const filteredSpeedRecords = this.filterByPeriod(this.data.speedRecords, period);
                const filteredActivities = this.filterByPeriod(this.data.recentActivities, period);
                
                switch (type) {
                    case 'vehicles':
                        dataToExport = { vehicles: this.data.vehicles };
                        filename = 'fleetcontrol-vehicles';
                        break;
                    case 'drivers':
                        dataToExport = { drivers: this.data.drivers };
                        filename = 'fleetcontrol-drivers';
                        break;
                    case 'speed':
                        dataToExport = { speedRecords: filteredSpeedRecords };
                        filename = 'fleetcontrol-speed-records';
                        break;
                    case 'activities':
                        dataToExport = { recentActivities: filteredActivities };
                        filename = 'fleetcontrol-activities';
                        break;
                    case 'reports':
                        dataToExport = this.generateReportData(period, 'general');
                        filename = 'fleetcontrol-report';
                        break;
                    default:
                        dataToExport = {
                            ...this.data,
                            speedRecords: filteredSpeedRecords,
                            recentActivities: filteredActivities
                        };
                        filename = 'fleetcontrol-backup';
                        break;
                }
                
                const exportInfo = {
                    exported: new Date().toISOString(),
                    version: '3.0',
                    type: type,
                    format: format,
                    period: period
                };
                
                dataToExport._export = exportInfo;
                
                if (format === 'json') {
                    this.downloadFile(
                        JSON.stringify(dataToExport, null, 2),
                        `${filename}-${new Date().toISOString().slice(0, 10)}.json`,
                        'application/json'
                    );
                } else if (format === 'csv') {
                    const csvContent = this.convertToCSV(dataToExport, type);
                    this.downloadFile(
                        csvContent,
                        `${filename}-${new Date().toISOString().slice(0, 10)}.csv`,
                        'text/csv'
                    );
                } else if (format === 'xlsx') {
                    this.exportToExcel(dataToExport, type, filename);
                } else if (format === 'pdf') {
                    this.exportToPDF(dataToExport, type, filename);
                }
                
                this.addActivity(`Dados exportados: ${type} (${format})`, 'fa-download', 'primary');
            }

            filterByPeriod(data, period) {
                if (period === 'all') return data;
                
                const days = parseInt(period);
                if (isNaN(days)) return data;
                
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                
                return data.filter(item => new Date(item.datetime) >= cutoffDate);
            }

            exportToExcel(data, type, filename) {
                if (!window.XLSX) {
                    this.addNotification('Erro', 'Biblioteca Excel não carregada', 'error');
                    return;
                }

                const workbook = XLSX.utils.book_new();
                
                if (type === 'vehicles' && data.vehicles) {
                    const ws = XLSX.utils.json_to_sheet(data.vehicles);
                    XLSX.utils.book_append_sheet(workbook, ws, 'Veículos');
                } else if (type === 'drivers' && data.drivers) {
                    const ws = XLSX.utils.json_to_sheet(data.drivers);
                    XLSX.utils.book_append_sheet(workbook, ws, 'Motoristas');
                } else if (type === 'speed' && data.speedRecords) {
                    const ws = XLSX.utils.json_to_sheet(data.speedRecords);
                    XLSX.utils.book_append_sheet(workbook, ws, 'Velocidade');
                } else {
                    // Multiple sheets for complete export
                    if (data.vehicles) {
                        const ws = XLSX.utils.json_to_sheet(data.vehicles);
                        XLSX.utils.book_append_sheet(workbook, ws, 'Veículos');
                    }
                    if (data.drivers) {
                        const ws = XLSX.utils.json_to_sheet(data.drivers);
                        XLSX.utils.book_append_sheet(workbook, ws, 'Motoristas');
                    }
                    if (data.speedRecords) {
                        const ws = XLSX.utils.json_to_sheet(data.speedRecords);
                        XLSX.utils.book_append_sheet(workbook, ws, 'Velocidade');
                    }
                }
                
                XLSX.writeFile(workbook, `${filename}-${new Date().toISOString().slice(0, 10)}.xlsx`);
                this.addNotification('Sucesso', 'Arquivo Excel exportado com sucesso!', 'success');
            }

            convertToCSV(data, type) {
                let csvContent = '';
                
                if (type === 'vehicles' && data.vehicles) {
                    csvContent = 'Placa,Modelo,Motorista,Vencimento Tacógrafo,Data Inspeção,Status,Ano,Cor\n';
                    data.vehicles.forEach(vehicle => {
                        csvContent += `"${vehicle.plate}","${vehicle.model}","${vehicle.driver || ''}","${vehicle.tachographExpiry}","${vehicle.inspectionDate}","${vehicle.status}","${vehicle.year || ''}","${vehicle.color || ''}"\n`;
                    });
                } else if (type === 'drivers' && data.drivers) {
                    csvContent = 'Nome,CNH,Categoria,Vencimento CNH,Veículo Atual,Status,Telefone,Email\n';
                    data.drivers.forEach(driver => {
                        csvContent += `"${driver.name}","${driver.license}","${driver.category}","${driver.licenseExpiry}","${driver.currentVehicle || ''}","${driver.status}","${driver.phone || ''}","${driver.email || ''}"\n`;
                    });
                } else if (type === 'speed' && data.speedRecords) {
                    csvContent = 'Data/Hora,Motorista,Veículo,Velocidade,Limite,Localização,Status,Observações\n';
                    data.speedRecords.forEach(record => {
                        csvContent += `"${record.datetime}","${record.driverName}","${record.vehiclePlate}","${record.speed}","${record.speedLimit}","${record.location}","${record.status}","${record.observations || ''}"\n`;
                    });
                }
                
                return csvContent;
            }

            downloadFile(content, filename, contentType) {
                const blob = new Blob([content], { type: contentType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            importData(data, overwrite = false) {
                let importCount = 0;

                if (data.vehicles) {
                    data.vehicles.forEach(vehicle => {
                        const existing = this.data.vehicles.find(v => v.plate === vehicle.plate);
                        if (!existing || overwrite) {
                            if (existing && overwrite) {
                                // Update existing
                                Object.assign(existing, vehicle);
                            } else {
                                // Add new
                                vehicle.id = Math.max(...this.data.vehicles.map(v => v.id), 0) + 1;
                                this.data.vehicles.push(vehicle);
                            }
                            importCount++;
                        }
                    });
                }
                
                if (data.drivers) {
                    data.drivers.forEach(driver => {
                        const existing = this.data.drivers.find(d => d.license === driver.license);
                        if (!existing || overwrite) {
                            if (existing && overwrite) {
                                // Update existing
                                Object.assign(existing, driver);
                            } else {
                                // Add new
                                driver.id = Math.max(...this.data.drivers.map(d => d.id), 0) + 1;
                                this.data.drivers.push(driver);
                            }
                            importCount++;
                        }
                    });
                }
                
                if (data.speedRecords) {
                    data.speedRecords.forEach(record => {
                        record.id = Math.max(...this.data.speedRecords.map(r => r.id), 0) + 1;
                        this.data.speedRecords.push(record);
                        importCount++;
                    });
                }
                
                this.addActivity(`Dados importados: ${importCount} registros`, 'fa-upload', 'info');
                this.autoSave();
                return importCount;
            }

            // ========================================
            // ENHANCED DEBOUNCE FUNCTIONS
            // ========================================

            debounce(func, wait, key) {
                clearTimeout(this.debounceTimers[key]);
                this.debounceTimers[key] = setTimeout(func, wait);
            }

            // ========================================
            // SYSTEM INFO FUNCTIONS
            // ========================================

            populateSystemInfo() {
                // Populate browser info
                const browserInfo = this.getBrowserInfo();
                const screenRes = `${screen.width}x${screen.height}`;
                
                setTimeout(() => {
                    setElementText('browserInfo', browserInfo);
                    setElementText('screenResolution', screenRes);
                    setElementText('lastSystemUpdate', new Date().toLocaleString('pt-BR'));
                }, 100);
            }

            getBrowserInfo() {
                const ua = navigator.userAgent;
                if (ua.includes('Chrome')) return 'Chrome';
                if (ua.includes('Firefox')) return 'Firefox';
                if (ua.includes('Safari')) return 'Safari';
                if (ua.includes('Edge')) return 'Edge';
                return 'Desconhecido';
            }
        }

        // Initialize the enhanced application with persistence
        const app = new FleetControlAppV3();

        // ========================================
        // ENHANCED UI FUNCTIONS
        // ========================================

        // Enhanced initialization
        document.addEventListener('DOMContentLoaded', function() {
            console.log('FleetControl Pro v3.0 inicializando com persistência...');
            
            try {
                showLoadingOverlay();
                
                setTimeout(() => {
                    initializeDateTime();
                    updateDashboard();
                    updateAllTables();
                    updateSpeedTracking();
                    initCharts();
                    setupEventListeners();
                    populateSelects();
                    updateDataStatistics();
                    populateYearFilters();
                    
                    // Set current datetime for forms
                    const now = new Date();
                    const currentDateTime = now.toISOString().slice(0, 16);
                    setElementValue('quickSpeedDateTime', currentDateTime);
                    setElementValue('speedDateTime', currentDateTime);
                    
                    // Set today's date
                    setElementText('todayDate', now.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }));
                    
                    hideLoadingOverlay();
                    
                    console.log('FleetControl Pro v3.0 inicializado com sucesso!');
                    
                }, 800);
                
            } catch (error) {
                console.error('Erro na inicialização:', error);
                hideLoadingOverlay();
                showToast('Erro', 'Falha na inicialização do sistema', 'error');
            }
        });

        // Enhanced loading overlay functions
        function showLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.classList.remove('hidden');
            }
        }

        function hideLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.classList.add('hidden');
            }
        }

        // Enhanced date and time display
        function initializeDateTime() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
        }

        function updateDateTime() {
            const now = new Date();
            const element = document.getElementById('currentDateTime');
            if (element) {
                element.textContent = now.toLocaleString('pt-BR', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            }
        }

        // Enhanced tab navigation
        function showTab(tabName) {
            try {
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.add('hidden');
                });
                
                // Update navigation buttons
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active-tab', 'border-primary', 'text-primary');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                
                // Show selected tab with animation
                const targetTab = document.getElementById(tabName);
                if (targetTab) {
                    targetTab.classList.remove('hidden');
                    targetTab.style.opacity = '0';
                    targetTab.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        targetTab.style.transition = 'all 0.3s ease-in-out';
                        targetTab.style.opacity = '1';
                        targetTab.style.transform = 'translateY(0)';
                    }, 10);
                }
                
                // Update active navigation button
                if (event && event.target) {
                    event.target.classList.remove('border-transparent', 'text-gray-500');
                    event.target.classList.add('active-tab', 'border-primary', 'text-primary');
                }
                
                // Tab-specific updates
                switch (tabName) {
                    case 'dashboard':
                        updateDashboard();
                        updatePerformanceMetrics();
                        break;
                    case 'vehicles':
                        updateVehiclesTable();
                        updateVehicleStatistics();
                        break;
                    case 'drivers':
                        updateDriversTable();
                        updateDriverStatistics();
                        break;
                    case 'speed-tracking':
                        updateSpeedTracking();
                        break;
                    case 'reports':
                        populateReportSelects();
                        break;
                    case 'backup':
                        updateDataStatistics();
                        break;
                }
                
                app.addActivity(`Navegou para: ${getTabLabel(tabName)}`, 'fa-mouse-pointer', 'info');
                
            } catch (error) {
                console.error('Erro ao mudar tab:', error);
                showToast('Erro', 'Erro ao navegar entre seções', 'error');
            }
        }

        function getTabLabel(tabName) {
            const labels = {
                dashboard: 'Dashboard',
                vehicles: 'Veículos',
                drivers: 'Motoristas',
                'speed-tracking': 'Monitoramento',
                reports: 'Relatórios',
                backup: 'Backup & Dados'
            };
            return labels[tabName] || tabName;
        }

        // Enhanced dashboard update
        function updateDashboard() {
            try {
                const stats = app.getStats();
                
                // Update basic stats
                setElementText('totalVehicles', stats.totalVehicles);
                setElementText('activeDrivers', app.data.drivers.filter(d => d.status === 'Ativo').length);
                setElementText('headerVehicleCount', stats.totalVehicles);
                
                // Calculate expirations
                const { expiringSoon, expired } = calculateExpirations();
                setElementText('expiringSoon', expiringSoon);
                setElementText('expired', expired);
                setElementText('headerAlertCount', expiringSoon + expired);
                setElementText('alertsCount', expiringSoon + expired);
                
                // Calculate compliance rate
                const totalDocuments = stats.totalVehicles + stats.totalDrivers;
                const compliantDocuments = totalDocuments - expiringSoon - expired;
                const complianceRate = totalDocuments > 0 ? Math.round((compliantDocuments / totalDocuments) * 100) : 100;
                setElementText('headerComplianceRate', `${complianceRate}%`);
                
                updateAlertsList();
                updateRecentActivity();
                updateTodayStats();
                
            } catch (error) {
                console.error('Erro ao atualizar dashboard:', error);
            }
        }

        function updatePerformanceMetrics() {
            try {
                const stats = app.getStats();
                const { expiringSoon, expired } = calculateExpirations();
                
                // Calculate performance metrics
                const totalDocuments = (stats.totalVehicles * 2) + stats.totalDrivers; // Each vehicle has 2 docs
                const compliantDocuments = totalDocuments - (expiringSoon * 2) - (expired * 2);
                const complianceRate = totalDocuments > 0 ? Math.round((compliantDocuments / totalDocuments) * 100) : 100;
                
                const totalVehicleDocs = stats.totalVehicles * 2;
                const compliantVehicleDocs = totalVehicleDocs - ((expiringSoon + expired) * 2);
                const docsUpToDate = totalVehicleDocs > 0 ? Math.round((compliantVehicleDocs / totalVehicleDocs) * 100) : 100;
                
                // Calculate average speed
                const recentSpeedRecords = app.data.speedRecords.slice(-10);
                const avgSpeed = recentSpeedRecords.length > 0 
                    ? Math.round(recentSpeedRecords.reduce((sum, r) => sum + r.speed, 0) / recentSpeedRecords.length)
                    : 0;
                
                const maxSpeed = 120;
                const speedPercentage = Math.round((avgSpeed / maxSpeed) * 100);
                
                // Update UI
                setElementText('complianceRate', `${complianceRate}%`);
                setElementText('docsUpToDate', `${docsUpToDate}%`);
                setElementText('fleetAvgSpeed', avgSpeed);
                setElementText('speedPercentage', `${speedPercentage}%`);
                setElementText('performanceScore', `${Math.round((complianceRate + docsUpToDate) / 2)}%`);
                setElementText('avgSpeedToday', `${avgSpeed} km/h`);
                
                // Update progress bars with animation
                setTimeout(() => {
                    const complianceBar = document.getElementById('complianceBar');
                    const docsBar = document.getElementById('docsBar');
                    
                    if (complianceBar) complianceBar.style.width = `${complianceRate}%`;
                    if (docsBar) docsBar.style.width = `${docsUpToDate}%`;
                }, 100);
                
            } catch (error) {
                console.error('Erro ao atualizar métricas de performance:', error);
            }
        }

        function updateTodayStats() {
            try {
                const today = new Date().toISOString().split('T')[0];
                
                const todayRecords = app.data.speedRecords.filter(r => r.datetime.startsWith(today));
                const todayViolations = todayRecords.filter(r => r.status.includes('Infração'));
                const todayActiveDrivers = new Set(todayRecords.map(r => r.driverId)).size;
                
                setElementText('todayRecords', todayRecords.length);
                setElementText('todayViolations', todayViolations.length);
                setElementText('todayActiveDrivers', todayActiveDrivers);
                
            } catch (error) {
                console.error('Erro ao atualizar estatísticas de hoje:', error);
            }
        }

        function calculateExpirations() {
            const today = new Date();
            const alertDays = app.settings.alertDays;
            const alertDate = new Date(today.getTime() + (alertDays * 24 * 60 * 60 * 1000));
            
            let expiringSoon = 0;
            let expired = 0;
            
            // Check vehicles
            app.data.vehicles.forEach(vehicle => {
                const tachographDate = new Date(vehicle.tachographExpiry);
                const inspectionDate = new Date(vehicle.inspectionDate);
                const inspectionExpiry = new Date(inspectionDate.getTime() + (2 * 365 * 24 * 60 * 60 * 1000));
                
                if (tachographDate < today || inspectionExpiry < today) {
                    expired++;
                } else if (tachographDate < alertDate || inspectionExpiry < alertDate) {
                    expiringSoon++;
                }
            });
            
            // Check drivers
            app.data.drivers.forEach(driver => {
                const licenseDate = new Date(driver.licenseExpiry);
                if (licenseDate < today) {
                    expired++;
                } else if (licenseDate < alertDate) {
                    expiringSoon++;
                }
            });
            
            return { expiringSoon, expired };
        }

        function updateAlertsList() {
            const alertsList = document.getElementById('alertsList');
            if (!alertsList) return;
            
            const alerts = [];
            const today = new Date();
            const alertDays = app.settings.alertDays;
            const alertDate = new Date(today.getTime() + (alertDays * 24 * 60 * 60 * 1000));
            
            // Document expiration alerts
            app.data.vehicles.forEach(vehicle => {
                const tachographDate = new Date(vehicle.tachographExpiry);
                
                if (tachographDate < today) {
                    alerts.push({
                        type: 'error',
                        icon: 'fa-exclamation-circle',
                        message: `Tacógrafo do veículo ${vehicle.plate} está vencido`,
                        date: vehicle.tachographExpiry,
                        priority: 'high'
                    });
                } else if (tachographDate < alertDate) {
                    alerts.push({
                        type: 'warning',
                        icon: 'fa-exclamation-triangle',
                        message: `Tacógrafo do veículo ${vehicle.plate} vence em breve`,
                        date: vehicle.tachographExpiry,
                        priority: 'medium'
                    });
                }
            });

            // Driver license alerts
            app.data.drivers.forEach(driver => {
                const licenseDate = new Date(driver.licenseExpiry);
                if (licenseDate < today) {
                    alerts.push({
                        type: 'error',
                        icon: 'fa-user-times',
                        message: `CNH de ${driver.name} está vencida`,
                        date: driver.licenseExpiry,
                        priority: 'high'
                    });
                } else if (licenseDate < alertDate) {
                    alerts.push({
                        type: 'warning',
                        icon: 'fa-user-clock',
                        message: `CNH de ${driver.name} vence em breve`,
                        date: driver.licenseExpiry,
                        priority: 'medium'
                    });
                }
            });

            // Speed violations
            const recentViolations = app.data.speedRecords.filter(record => {
                const recordDate = new Date(record.datetime);
                const yesterday = new Date(Date.now() - (24 * 60 * 60 * 1000));
                return recordDate > yesterday && record.status.includes('Infração');
            });

            recentViolations.forEach(violation => {
                alerts.push({
                    type: violation.status === 'Infração Grave' ? 'error' : 'warning',
                    icon: 'fa-tachometer-alt',
                    message: `${violation.driverName} - ${violation.speed}km/h (Limite: ${violation.speedLimit}km/h)`,
                    date: violation.datetime,
                    priority: violation.status === 'Infração Grave' ? 'high' : 'medium'
                });
            });

            // Sort alerts by priority and date
            alerts.sort((a, b) => {
                const priorityOrder = { high: 3, medium: 2, low: 1 };
                if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                    return priorityOrder[b.priority] - priorityOrder[a.priority];
                }
                return new Date(a.date) - new Date(b.date);
            });
            
            if (alerts.length === 0) {
                alertsList.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-check-circle text-success text-4xl mb-3"></i>
                        <p class="text-gray-500 dark:text-gray-400 font-medium">Nenhum alerta no momento</p>
                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">Todos os documentos estão em dia</p>
                    </div>
                `;
            } else {
                alertsList.innerHTML = alerts.slice(0, 5).map(alert => `
                    <div class="flex items-start p-4 rounded-lg border-l-4 ${
                        alert.type === 'error' 
                            ? 'bg-red-50 dark:bg-red-900/20 border-red-500' 
                            : 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-500'
                    } hover:shadow-md transition-all duration-200 ${alert.priority === 'high' ? 'animate-pulse' : ''}">
                        <i class="fas ${alert.icon} ${
                            alert.type === 'error' ? 'text-red-500' : 'text-yellow-500'
                        } mr-3 mt-1"></i>
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <p class="text-sm font-medium ${
                                    alert.type === 'error' 
                                        ? 'text-red-800 dark:text-red-200' 
                                        : 'text-yellow-800 dark:text-yellow-200'
                                }">${alert.message}</p>
                                <span class="text-xs px-2 py-1 rounded-full ${
                                    alert.priority === 'high' 
                                        ? 'bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200'
                                        : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/40 dark:text-yellow-200'
                                }">${alert.priority === 'high' ? 'Alta' : 'Média'}</span>
                            </div>
                            <p class="text-xs ${
                                alert.type === 'error' 
                                    ? 'text-red-600 dark:text-red-300' 
                                    : 'text-yellow-600 dark:text-yellow-300'
                            } mt-1">
                                ${new Date(alert.date).toLocaleDateString('pt-BR')}
                            </p>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateRecentActivity() {
            const recentActivity = document.getElementById('recentActivity');
            if (!recentActivity) return;
            
            const activities = app.data.recentActivities;
            
            if (activities.length === 0) {
                recentActivity.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-clock text-gray-300 dark:text-gray-600 text-4xl mb-3"></i>
                        <p class="text-gray-500 dark:text-gray-400 font-medium">Nenhuma atividade recente</p>
                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">As ações do sistema aparecerão aqui</p>
                    </div>
                `;
            } else {
                recentActivity.innerHTML = activities.slice(0, 10).map(activity => `
                    <div class="flex items-start p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200 group">
                        <div class="flex-shrink-0 p-2 bg-${activity.color}/10 rounded-lg group-hover:bg-${activity.color}/20 transition-colors">
                            <i class="fas ${activity.icon} text-${activity.color}"></i>
                        </div>
                        <div class="ml-3 flex-1">
                            <p class="text-sm font-medium text-gray-900 dark:text-white">${activity.message}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                ${new Date(activity.datetime).toLocaleString('pt-BR')}
                            </p>
                        </div>
                    </div>
                `).join('');
            }
        }

        function clearRecentActivity() {
            showConfirmDialog('Tem certeza que deseja limpar o histórico de atividades?', () => {
                app.data.recentActivities = [];
                app.autoSave();
                updateRecentActivity();
                showToast('Histórico Limpo', 'Histórico de atividades foi limpo', 'info');
            });
        }

        function refreshAlerts() {
            updateAlertsList();
            showToast('Atualizado', 'Lista de alertas foi atualizada', 'success');
        }

        function refreshRecentActivity() {
            updateRecentActivity();
            showToast('Atualizado', 'Atividades recentes foram atualizadas', 'success');
        }

        // ========================================
        // ENHANCED VEHICLES MANAGEMENT
        // ========================================

        function updateVehiclesTable() {
            const table = document.getElementById('vehiclesTable');
            if (!table) return;
            
            const search = app.filters.vehicles.search;
            const status = app.filters.vehicles.status;
            const year = app.filters.vehicles.year;
            let filteredVehicles = app.searchVehicles(search, status, year);
            
            // Apply pagination
            const pagination = app.pagination.vehicles;
            const startIndex = (pagination.currentPage - 1) * pagination.itemsPerPage;
            const endIndex = startIndex + pagination.itemsPerPage;
            const paginatedVehicles = filteredVehicles.slice(startIndex, endIndex);
            
            table.innerHTML = paginatedVehicles.map(vehicle => {
                const statusClass = getStatusClass(vehicle.status);
                const age = vehicle.year ? new Date().getFullYear() - vehicle.year : 0;
                
                return `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200 table-enhanced">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-8 w-8 bg-gradient-to-br from-primary/20 to-primary/10 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-truck text-primary text-sm"></i>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white">${vehicle.plate}</span>
                                    ${vehicle.year ? `<p class="text-xs text-gray-500 dark:text-gray-400">${age} anos</p>` : ''}
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div>
                                <span class="text-sm text-gray-900 dark:text-white">${vehicle.model}</span>
                                ${vehicle.color ? `<p class="text-xs text-gray-500 dark:text-gray-400">${vehicle.color}</p>` : ''}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                            ${vehicle.driver ? `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-200">${vehicle.driver}</span>` : '<span class="text-gray-400">Não atribuído</span>'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                            <div class="flex items-center">
                                <span>${new Date(vehicle.tachographExpiry).toLocaleDateString('pt-BR')}</span>
                                ${getDaysUntilExpiry(vehicle.tachographExpiry) <= app.settings.alertDays ? '<i class="fas fa-exclamation-triangle text-warning ml-2"></i>' : ''}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${new Date(vehicle.inspectionDate).toLocaleDateString('pt-BR')}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${vehicle.status}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="editVehicle(${vehicle.id})" class="text-primary hover:text-primary/80 transition-colors p-1 hover:bg-primary/10 rounded" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="viewVehicleDetails(${vehicle.id})" class="text-info hover:text-info/80 transition-colors p-1 hover:bg-info/10 rounded" title="Visualizar">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="deleteVehicle(${vehicle.id})" class="text-red-600 hover:text-red-800 transition-colors p-1 hover:bg-red-100 dark:hover:bg-red-900/20 rounded" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            updateVehiclesPagination(filteredVehicles.length);
        }

        function updateVehicleStatistics() {
            const stats = {
                total: app.data.vehicles.length,
                active: 0,
                alerts: 0,
                avgAge: 0
            };
            
            const today = new Date();
            const alertDays = app.settings.alertDays;
            const alertDate = new Date(today.getTime() + (alertDays * 24 * 60 * 60 * 1000));
            
            let totalAge = 0;
            let vehiclesWithYear = 0;
            
            app.data.vehicles.forEach(vehicle => {
                if (vehicle.status === 'Em dia') {
                    stats.active++;
                }
                if (vehicle.status === 'A vencer' || vehicle.status === 'Vencido') {
                    stats.alerts++;
                }
                if (vehicle.year) {
                    totalAge += new Date().getFullYear() - vehicle.year;
                    vehiclesWithYear++;
                }
            });
            
            stats.avgAge = vehiclesWithYear > 0 ? Math.round(totalAge / vehiclesWithYear) : 0;
            
            setElementText('vehicleStatsTotal', stats.total);
            setElementText('vehicleStatsActive', stats.active);
            setElementText('vehicleStatsAlerts', stats.alerts);
            setElementText('vehicleStatsAvgAge', `${stats.avgAge} anos`);
        }

        function updateVehiclesPagination(totalItems) {
            const pagination = app.pagination.vehicles;
            const totalPages = Math.ceil(totalItems / pagination.itemsPerPage);
            
            const startItem = (pagination.currentPage - 1) * pagination.itemsPerPage + 1;
            const endItem = Math.min(pagination.currentPage * pagination.itemsPerPage, totalItems);
            
            setElementText('vehiclesShowingStart', totalItems > 0 ? startItem : 0);
            setElementText('vehiclesShowingEnd', endItem);
            setElementText('vehiclesTotal', totalItems);
            
            const prevBtn = document.getElementById('vehiclesPrevBtn');
            const nextBtn = document.getElementById('vehiclesNextBtn');
            const prevBtnMobile = document.getElementById('vehiclesPrevBtnMobile');
            const nextBtnMobile = document.getElementById('vehiclesNextBtnMobile');
            
            [prevBtn, prevBtnMobile].forEach(btn => {
                if (btn) {
                    btn.disabled = pagination.currentPage <= 1;
                    btn.classList.toggle('opacity-50', pagination.currentPage <= 1);
                }
            });
            
            [nextBtn, nextBtnMobile].forEach(btn => {
                if (btn) {
                    btn.disabled = pagination.currentPage >= totalPages;
                    btn.classList.toggle('opacity-50', pagination.currentPage >= totalPages);
                }
            });
        }

        function filterVehicles() {
            app.filters.vehicles.search = getElementValue('vehicleSearch') || '';
            app.filters.vehicles.status = getElementValue('vehicleStatusFilter') || '';
            app.filters.vehicles.year = getElementValue('vehicleYearFilter') || '';
            app.pagination.vehicles.currentPage = 1;
            updateVehiclesTable();
        }

        function debouncedVehicleSearch() {
            const searchInput = document.getElementById('vehicleSearch');
            const loadingIndicator = document.getElementById('vehicleSearchLoading');
            
            if (loadingIndicator) loadingIndicator.classList.remove('hidden');
            
            app.debounce(() => {
                filterVehicles();
                if (loadingIndicator) loadingIndicator.classList.add('hidden');
            }, 300, 'vehicleSearch');
        }

        function sortVehicles(field) {
            const sorting = app.sorting.vehicles;
            if (sorting.field === field) {
                sorting.direction = sorting.direction === 'asc' ? 'desc' : 'asc';
            } else {
                sorting.field = field;
                sorting.direction = 'asc';
            }
            updateVehiclesTable();
        }

        function previousVehiclesPage() {
            if (app.pagination.vehicles.currentPage > 1) {
                app.pagination.vehicles.currentPage--;
                updateVehiclesTable();
            }
        }

        function nextVehiclesPage() {
            const search = app.filters.vehicles.search;
            const status = app.filters.vehicles.status;
            const year = app.filters.vehicles.year;
            const totalItems = app.searchVehicles(search, status, year).length;
            const totalPages = Math.ceil(totalItems / app.pagination.vehicles.itemsPerPage);
            
            if (app.pagination.vehicles.currentPage < totalPages) {
                app.pagination.vehicles.currentPage++;
                updateVehiclesTable();
            }
        }

        function editVehicle(id) {
            const vehicle = app.data.vehicles.find(v => v.id === id);
            if (vehicle) {
                showEditVehicleModal(vehicle);
            }
        }

        function viewVehicleDetails(id) {
            const vehicle = app.data.vehicles.find(v => v.id === id);
            if (vehicle) {
                const age = vehicle.year ? new Date().getFullYear() - vehicle.year : 'N/A';
                const details = `
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-4">
                            <div><strong>Placa:</strong> ${vehicle.plate}</div>
                            <div><strong>Modelo:</strong> ${vehicle.model}</div>
                            <div><strong>Ano:</strong> ${vehicle.year || 'Não informado'}</div>
                            <div><strong>Idade:</strong> ${age} anos</div>
                            <div><strong>Cor:</strong> ${vehicle.color || 'Não informada'}</div>
                            <div><strong>Combustível:</strong> ${vehicle.fuelType || 'Diesel'}</div>
                        </div>
                        <hr class="border-gray-200 dark:border-gray-600">
                        <div class="grid grid-cols-1 gap-2">
                            <div><strong>Motorista:</strong> ${vehicle.driver || 'Não atribuído'}</div>
                            <div><strong>Vencimento do Tacógrafo:</strong> ${new Date(vehicle.tachographExpiry).toLocaleDateString('pt-BR')}</div>
                            <div><strong>Data da Inspeção:</strong> ${new Date(vehicle.inspectionDate).toLocaleDateString('pt-BR')}</div>
                            <div><strong>Última Manutenção:</strong> ${vehicle.lastMaintenance ? new Date(vehicle.lastMaintenance).toLocaleDateString('pt-BR') : 'N/A'}</div>
                            <div><strong>Status:</strong> <span class="px-2 py-1 rounded text-xs ${getStatusClass(vehicle.status)}">${vehicle.status}</span></div>
                        </div>
                    </div>
                `;
                showCustomDialog(`Detalhes do Veículo ${vehicle.plate}`, details);
            }
        }

        function deleteVehicle(id) {
            const vehicle = app.data.vehicles.find(v => v.id === id);
            if (vehicle) {
                showConfirmDialog(`Tem certeza que deseja excluir o veículo ${vehicle.plate}?`, () => {
                    if (app.removeVehicle(id)) {
                        updateVehiclesTable();
                        updateDashboard();
                        updateDataStatistics();
                        showToast('Veículo Excluído', `Veículo ${vehicle.plate} foi removido`, 'warning');
                    }
                });
            }
        }

        // ========================================
        // ENHANCED DRIVERS MANAGEMENT
        // ========================================

        function updateDriversTable() {
            const table = document.getElementById('driversTable');
            if (!table) return;
            
            const search = app.filters.drivers.search;
            const category = app.filters.drivers.category;
            const status = app.filters.drivers.status;
            let filteredDrivers = app.searchDrivers(search, category, status);
            
            // Apply pagination
            const pagination = app.pagination.drivers;
            const startIndex = (pagination.currentPage - 1) * pagination.itemsPerPage;
            const endIndex = startIndex + pagination.itemsPerPage;
            const paginatedDrivers = filteredDrivers.slice(startIndex, endIndex);
            
            const today = new Date();
            
            table.innerHTML = paginatedDrivers.map(driver => {
                const licenseDate = new Date(driver.licenseExpiry);
                let licenseStatus = 'Em dia';
                let statusClass = 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200';
                
                if (licenseDate < today) {
                    licenseStatus = 'CNH Vencida';
                    statusClass = 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200';
                } else if (licenseDate < new Date(today.getTime() + (app.settings.alertDays * 24 * 60 * 60 * 1000))) {
                    licenseStatus = 'CNH a vencer';
                    statusClass = 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-200';
                }

                const age = driver.birthDate ? new Date().getFullYear() - new Date(driver.birthDate).getFullYear() : 0;
                
                return `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200 table-enhanced">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-8 w-8 bg-gradient-to-br from-info/20 to-info/10 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-user text-info text-sm"></i>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white">${driver.name}</span>
                                    ${age > 0 ? `<p class="text-xs text-gray-500 dark:text-gray-400">${age} anos</p>` : ''}
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${driver.license}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-200">
                                ${driver.category}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <span class="text-sm text-gray-500 dark:text-gray-300">${new Date(driver.licenseExpiry).toLocaleDateString('pt-BR')}</span>
                                ${getDaysUntilExpiry(driver.licenseExpiry) <= app.settings.alertDays ? '<i class="fas fa-exclamation-triangle text-warning ml-2"></i>' : ''}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                            ${driver.currentVehicle ? `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200">${driver.currentVehicle}</span>` : '<span class="text-gray-400">Nenhum</span>'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${licenseStatus}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="editDriver(${driver.id})" class="text-primary hover:text-primary/80 transition-colors p-1 hover:bg-primary/10 rounded" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="viewDriverDetails(${driver.id})" class="text-info hover:text-info/80 transition-colors p-1 hover:bg-info/10 rounded" title="Visualizar">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="deleteDriver(${driver.id})" class="text-red-600 hover:text-red-800 transition-colors p-1 hover:bg-red-100 dark:hover:bg-red-900/20 rounded" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            updateDriversPagination(filteredDrivers.length);
        }

        function updateDriverStatistics() {
            const stats = {
                total: app.data.drivers.length,
                active: app.data.drivers.filter(d => d.status === 'Ativo').length,
                expiring: 0,
                expired: 0
            };
            
            const today = new Date();
            const alertDays = app.settings.alertDays;
            const alertDate = new Date(today.getTime() + (alertDays * 24 * 60 * 60 * 1000));
            
            app.data.drivers.forEach(driver => {
                const licenseDate = new Date(driver.licenseExpiry);
                if (licenseDate < today) {
                    stats.expired++;
                } else if (licenseDate < alertDate) {
                    stats.expiring++;
                }
            });
            
            setElementText('driverStatsTotal', stats.total);
            setElementText('driverStatsActive', stats.active);
            setElementText('driverStatsExpiring', stats.expiring);
            setElementText('driverStatsExpired', stats.expired);
        }

        function updateDriversPagination(totalItems) {
            const pagination = app.pagination.drivers;
            const totalPages = Math.ceil(totalItems / pagination.itemsPerPage);
            
            const startItem = (pagination.currentPage - 1) * pagination.itemsPerPage + 1;
            const endItem = Math.min(pagination.currentPage * pagination.itemsPerPage, totalItems);
            
            setElementText('driversShowingStart', totalItems > 0 ? startItem : 0);
            setElementText('driversShowingEnd', endItem);
            setElementText('driversTotal', totalItems);
            
            const prevBtn = document.getElementById('driversPrevBtn');
            const nextBtn = document.getElementById('driversNextBtn');
            const prevBtnMobile = document.getElementById('driversPrevBtnMobile');
            const nextBtnMobile = document.getElementById('driversNextBtnMobile');
            
            [prevBtn, prevBtnMobile].forEach(btn => {
                if (btn) {
                    btn.disabled = pagination.currentPage <= 1;
                    btn.classList.toggle('opacity-50', pagination.currentPage <= 1);
                }
            });
            
            [nextBtn, nextBtnMobile].forEach(btn => {
                if (btn) {
                    btn.disabled = pagination.currentPage >= totalPages;
                    btn.classList.toggle('opacity-50', pagination.currentPage >= totalPages);
                }
            });
        }

        function filterDrivers() {
            app.filters.drivers.search = getElementValue('driverSearch') || '';
            app.filters.drivers.category = getElementValue('driverCategoryFilter') || '';
            app.filters.drivers.status = getElementValue('driverStatusFilter') || '';
            app.pagination.drivers.currentPage = 1;
            updateDriversTable();
        }

        function debouncedDriverSearch() {
            const searchInput = document.getElementById('driverSearch');
            const loadingIndicator = document.getElementById('driverSearchLoading');
            
            if (loadingIndicator) loadingIndicator.classList.remove('hidden');
            
            app.debounce(() => {
                filterDrivers();
                if (loadingIndicator) loadingIndicator.classList.add('hidden');
            }, 300, 'driverSearch');
        }

        function sortDrivers(field) {
            const sorting = app.sorting.drivers;
            if (sorting.field === field) {
                sorting.direction = sorting.direction === 'asc' ? 'desc' : 'asc';
            } else {
                sorting.field = field;
                sorting.direction = 'asc';
            }
            updateDriversTable();
        }

        function previousDriversPage() {
            if (app.pagination.drivers.currentPage > 1) {
                app.pagination.drivers.currentPage--;
                updateDriversTable();
            }
        }

        function nextDriversPage() {
            const search = app.filters.drivers.search;
            const category = app.filters.drivers.category;
            const status = app.filters.drivers.status;
            const totalItems = app.searchDrivers(search, category, status).length;
            const totalPages = Math.ceil(totalItems / app.pagination.drivers.itemsPerPage);
            
            if (app.pagination.drivers.currentPage < totalPages) {
                app.pagination.drivers.currentPage++;
                updateDriversTable();
            }
        }

        function editDriver(id) {
            const driver = app.data.drivers.find(d => d.id === id);
            if (driver) {
                showEditDriverModal(driver);
            }
        }

        function viewDriverDetails(id) {
            const driver = app.data.drivers.find(d => d.id === id);
            if (driver) {
                const age = driver.birthDate ? new Date().getFullYear() - new Date(driver.birthDate).getFullYear() : 'N/A';
                const details = `
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-4">
                            <div><strong>Nome:</strong> ${driver.name}</div>
                            <div><strong>Idade:</strong> ${age} anos</div>
                            <div><strong>CNH:</strong> ${driver.license}</div>
                            <div><strong>Categoria:</strong> ${driver.category}</div>
                        </div>
                        <hr class="border-gray-200 dark:border-gray-600">
                        <div class="grid grid-cols-1 gap-2">
                            <div><strong>Vencimento da CNH:</strong> ${new Date(driver.licenseExpiry).toLocaleDateString('pt-BR')}</div>
                            <div><strong>Veículo Atual:</strong> ${driver.currentVehicle || 'Nenhum'}</div>
                            <div><strong>Status:</strong> ${driver.status}</div>
                            ${driver.birthDate ? `<div><strong>Data de Nascimento:</strong> ${new Date(driver.birthDate).toLocaleDateString('pt-BR')}</div>` : ''}
                            ${driver.hireDate ? `<div><strong>Data de Contratação:</strong> ${new Date(driver.hireDate).toLocaleDateString('pt-BR')}</div>` : ''}
                            ${driver.phone ? `<div><strong>Telefone:</strong> ${driver.phone}</div>` : ''}
                            ${driver.email ? `<div><strong>Email:</strong> ${driver.email}</div>` : ''}
                        </div>
                    </div>
                `;
                showCustomDialog(`Detalhes do Motorista ${driver.name}`, details);
            }
        }

        function deleteDriver(id) {
            const driver = app.data.drivers.find(d => d.id === id);
            if (driver) {
                showConfirmDialog(`Tem certeza que deseja excluir o motorista ${driver.name}?`, () => {
                    if (app.removeDriver(id)) {
                        updateDriversTable();
                        updateDashboard();
                        updateDataStatistics();
                        showToast('Motorista Excluído', `Motorista ${driver.name} foi removido`, 'warning');
                    }
                });
            }
        }

        // ========================================
        // ENHANCED SPEED TRACKING MANAGEMENT
        // ========================================

        function updateSpeedTracking() {
            updateSpeedHistoryTable();
            updateSpeedStatus();
            updateSpeedAlerts();
        }

        function updateSpeedHistoryTable() {
            const table = document.getElementById('speedHistoryTable');
            if (!table) return;
            
            const filters = {
                date: app.filters.speedRecords.date,
                driver: app.filters.speedRecords.driver,
                status: app.filters.speedRecords.status
            };
            
            let filteredRecords = app.searchSpeedRecords(filters);
            
            // Apply pagination
            const pagination = app.pagination.speedRecords;
            const startIndex = (pagination.currentPage - 1) * pagination.itemsPerPage;
            const endIndex = startIndex + pagination.itemsPerPage;
            const paginatedRecords = filteredRecords.slice(startIndex, endIndex);
            
            table.innerHTML = paginatedRecords.map(record => {
                const statusClass = getSpeedStatusClass(record.status);
                const driver = app.data.drivers.find(d => d.id === record.driverId);
                const vehicle = app.data.vehicles.find(v => v.plate === record.vehiclePlate);
                
                return `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200 table-enhanced">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                            ${new Date(record.datetime).toLocaleString('pt-BR')}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-8 w-8 bg-gradient-to-br from-warning/20 to-warning/10 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-user text-warning text-sm"></i>
                                </div>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${record.driverName}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                            ${record.vehiclePlate || 'N/A'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <span class="text-lg font-bold ${record.speed > record.speedLimit ? 'text-red-600' : 'text-green-600'}">${record.speed}</span>
                                <span class="text-sm text-gray-500 dark:text-gray-400 ml-1">km/h</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${record.speedLimit} km/h</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${record.location}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${record.status}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="viewSpeedDetails(${record.id})" class="text-info hover:text-info/80 transition-colors p-1 hover:bg-info/10 rounded" title="Visualizar">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="deleteSpeedRecord(${record.id})" class="text-red-600 hover:text-red-800 transition-colors p-1 hover:bg-red-100 dark:hover:bg-red-900/20 rounded" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            updateSpeedPagination(filteredRecords.length);
        }

        function updateSpeedStatus() {
            const statusContainer = document.getElementById('currentSpeedStatus');
            if (!statusContainer) return;
            
            const todayRecords = app.data.speedRecords.filter(r => {
                const recordDate = new Date(r.datetime);
                const today = new Date();
                return recordDate.toDateString() === today.toDateString();
            });
            
            const activeDrivers = new Set(todayRecords.map(r => r.driverId));
            const violations = todayRecords.filter(r => r.status.includes('Infração'));
            
            statusContainer.innerHTML = `
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="text-lg font-semibold text-blue-700 dark:text-blue-300">Motoristas Ativos</h4>
                            <p class="text-2xl font-bold text-blue-800 dark:text-blue-200">${activeDrivers.size}</p>
                        </div>
                        <i class="fas fa-users text-blue-500 text-3xl"></i>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-4 rounded-lg border border-green-200 dark:border-green-800">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="text-lg font-semibold text-green-700 dark:text-green-300">Registros Hoje</h4>
                            <p class="text-2xl font-bold text-green-800 dark:text-green-200">${todayRecords.length}</p>
                        </div>
                        <i class="fas fa-tachometer-alt text-green-500 text-3xl"></i>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="text-lg font-semibold text-yellow-700 dark:text-yellow-300">Infrações Hoje</h4>
                            <p class="text-2xl font-bold text-yellow-800 dark:text-yellow-200">${violations.length}</p>
                        </div>
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-3xl"></i>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="text-lg font-semibold text-purple-700 dark:text-purple-300">Velocidade Média</h4>
                            <p class="text-2xl font-bold text-purple-800 dark:text-purple-200">
                                ${todayRecords.length > 0 ? Math.round(todayRecords.reduce((sum, r) => sum + r.speed, 0) / todayRecords.length) : 0} km/h
                            </p>
                        </div>
                        <i class="fas fa-chart-line text-purple-500 text-3xl"></i>
                    </div>
                </div>
            `;
        }

        function updateSpeedAlerts() {
            const alertsContainer = document.getElementById('speedAlerts');
            const alertsCount = document.getElementById('speedAlertsCount');
            if (!alertsContainer) return;
            
            const recentViolations = app.data.speedRecords.filter(record => {
                const recordDate = new Date(record.datetime);
                const hours24Ago = new Date(Date.now() - (24 * 60 * 60 * 1000));
                return recordDate > hours24Ago && record.status.includes('Infração');
            }).slice(0, 10);
            
            if (alertsCount) {
                alertsCount.textContent = recentViolations.length;
            }
            
            if (recentViolations.length === 0) {
                alertsContainer.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-check-circle text-green-500 text-4xl mb-3"></i>
                        <p class="text-gray-500 dark:text-gray-400 font-medium">Nenhuma infração nas últimas 24h</p>
                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">Todos os motoristas respeitando os limites</p>
                    </div>
                `;
            } else {
                alertsContainer.innerHTML = recentViolations.map(violation => `
                    <div class="flex items-start p-3 rounded-lg border-l-4 ${
                        violation.status === 'Infração Grave' 
                            ? 'bg-red-50 dark:bg-red-900/20 border-red-500' 
                            : 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-500'
                    } hover:shadow-md transition-all duration-200">
                        <i class="fas fa-exclamation-triangle ${
                            violation.status === 'Infração Grave' ? 'text-red-500' : 'text-yellow-500'
                        } mr-3 mt-1"></i>
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium ${
                                        violation.status === 'Infração Grave' 
                                            ? 'text-red-800 dark:text-red-200' 
                                            : 'text-yellow-800 dark:text-yellow-200'
                                    }">${violation.driverName}</p>
                                    <p class="text-xs ${
                                        violation.status === 'Infração Grave' 
                                            ? 'text-red-600 dark:text-red-300' 
                                            : 'text-yellow-600 dark:text-yellow-300'
                                    }">
                                        ${violation.speed}km/h em limite de ${violation.speedLimit}km/h
                                    </p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                        ${new Date(violation.datetime).toLocaleString('pt-BR')} - ${violation.location}
                                    </p>
                                </div>
                                <span class="text-xs px-2 py-1 rounded-full ${
                                    violation.status === 'Infração Grave' 
                                        ? 'bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200'
                                        : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/40 dark:text-yellow-200'
                                }">${violation.status}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateSpeedPagination(totalItems) {
            const pagination = app.pagination.speedRecords;
            const totalPages = Math.ceil(totalItems / pagination.itemsPerPage);
            
            const startItem = (pagination.currentPage - 1) * pagination.itemsPerPage + 1;
            const endItem = Math.min(pagination.currentPage * pagination.itemsPerPage, totalItems);
            
            setElementText('speedShowingStart', totalItems > 0 ? startItem : 0);
            setElementText('speedShowingEnd', endItem);
            setElementText('speedTotal', totalItems);
            
            const prevBtn = document.getElementById('speedPrevBtn');
            const nextBtn = document.getElementById('speedNextBtn');
            const prevBtnMobile = document.getElementById('speedPrevBtnMobile');
            const nextBtnMobile = document.getElementById('speedNextBtnMobile');
            
            [prevBtn, prevBtnMobile].forEach(btn => {
                if (btn) {
                    btn.disabled = pagination.currentPage <= 1;
                    btn.classList.toggle('opacity-50', pagination.currentPage <= 1);
                }
            });
            
            [nextBtn, nextBtnMobile].forEach(btn => {
                if (btn) {
                    btn.disabled = pagination.currentPage >= totalPages;
                    btn.classList.toggle('opacity-50', pagination.currentPage >= totalPages);
                }
            });
        }

        function filterSpeedHistory() {
            app.filters.speedRecords.date = getElementValue('speedHistoryDate') || '';
            app.filters.speedRecords.driver = getElementValue('speedHistoryDriver') || '';
            app.filters.speedRecords.status = getElementValue('speedHistoryStatus') || '';
            app.pagination.speedRecords.currentPage = 1;
            updateSpeedHistoryTable();
        }

        function sortSpeedRecords(field) {
            const sorting = app.sorting.speedRecords;
            if (sorting.field === field) {
                sorting.direction = sorting.direction === 'asc' ? 'desc' : 'asc';
            } else {
                sorting.field = field;
                sorting.direction = field === 'datetime' ? 'desc' : 'asc';
            }
            updateSpeedHistoryTable();
        }

        function previousSpeedPage() {
            if (app.pagination.speedRecords.currentPage > 1) {
                app.pagination.speedRecords.currentPage--;
                updateSpeedHistoryTable();
            }
        }

        function nextSpeedPage() {
            const filters = {
                date: app.filters.speedRecords.date,
                driver: app.filters.speedRecords.driver,
                status: app.filters.speedRecords.status
            };
            const totalItems = app.searchSpeedRecords(filters).length;
            const totalPages = Math.ceil(totalItems / app.pagination.speedRecords.itemsPerPage);
            
            if (app.pagination.speedRecords.currentPage < totalPages) {
                app.pagination.speedRecords.currentPage++;
                updateSpeedHistoryTable();
            }
        }

        function viewSpeedDetails(id) {
            const record = app.data.speedRecords.find(r => r.id === id);
            if (record) {
                const exceedingAmount = record.speed - record.speedLimit;
                const exceedingPercentage = Math.round((exceedingAmount / record.speedLimit) * 100);
                
                const details = `
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div><strong>Data/Hora:</strong> ${new Date(record.datetime).toLocaleString('pt-BR')}</div>
                            <div><strong>Motorista:</strong> ${record.driverName}</div>
                            <div><strong>Veículo:</strong> ${record.vehiclePlate || 'N/A'}</div>
                            <div><strong>Localização:</strong> ${record.location}</div>
                        </div>
                        <hr class="border-gray-200 dark:border-gray-600">
                        <div class="grid grid-cols-2 gap-4">
                            <div><strong>Velocidade Registrada:</strong> <span class="text-lg font-bold ${record.speed > record.speedLimit ? 'text-red-600' : 'text-green-600'}">${record.speed} km/h</span></div>
                            <div><strong>Limite da Via:</strong> ${record.speedLimit} km/h</div>
                            ${exceedingAmount > 0 ? `<div><strong>Excesso:</strong> <span class="text-red-600 font-bold">+${exceedingAmount} km/h (${exceedingPercentage}%)</span></div>` : ''}
                            <div><strong>Status:</strong> <span class="px-2 py-1 rounded text-xs ${getSpeedStatusClass(record.status)}">${record.status}</span></div>
                        </div>
                        ${record.observations ? `
                        <hr class="border-gray-200 dark:border-gray-600">
                        <div><strong>Observações:</strong><br>${record.observations}</div>
                        ` : ''}
                        ${record.weather ? `<div><strong>Condições Climáticas:</strong> ${record.weather}</div>` : ''}
                        ${record.trafficCondition ? `<div><strong>Condições do Tráfego:</strong> ${record.trafficCondition}</div>` : ''}
                    </div>
                `;
                showCustomDialog(`Registro de Velocidade - ${record.driverName}`, details);
            }
        }

        function deleteSpeedRecord(id) {
            showConfirmDialog('Tem certeza que deseja excluir este registro de velocidade?', () => {
                if (app.removeSpeedRecord(id)) {
                    updateSpeedHistoryTable();
                    updateSpeedTracking();
                    updateDashboard();
                    updateDataStatistics();
                    showToast('Registro Excluído', 'Registro de velocidade foi removido', 'warning');
                }
            });
        }

        function refreshSpeedStatus() {
            updateSpeedStatus();
            showToast('Atualizado', 'Status da frota foi atualizado', 'success');
        }

        function refreshSpeedAlerts() {
            updateSpeedAlerts();
            showToast('Atualizado', 'Alertas de velocidade foram atualizados', 'success');
        }

        function exportSpeedData() {
            try {
                app.exportData('speed', 'xlsx', 'all');
                showToast('Exportado', 'Dados de velocidade exportados para Excel', 'success');
            } catch (error) {
                console.error('Erro ao exportar dados de velocidade:', error);
                showToast('Erro', 'Falha ao exportar dados de velocidade', 'error');
            }
        }

        // ========================================
        // ENHANCED MODAL FUNCTIONS
        // ========================================

        function showSpeedEntryModal() {
            const modal = document.getElementById('speedEntryModal');
            const content = document.getElementById('speedEntryModalContent');
            if (modal && content) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.style.transform = 'scale(1)';
                    content.style.opacity = '1';
                }, 10);
                
                // Populate drivers
                populateDriverSelect('quickSpeedDriver');
                
                // Set current date/time
                const now = new Date();
                const currentDateTime = now.toISOString().slice(0, 16);
                setElementValue('quickSpeedDateTime', currentDateTime);
                
                // Focus first field
                setTimeout(() => {
                    const firstInput = document.getElementById('quickSpeedDriver');
                    if (firstInput) firstInput.focus();
                }, 100);
            }
        }

        function closeSpeedEntryModal() {
            const modal = document.getElementById('speedEntryModal');
            const content = document.getElementById('speedEntryModalContent');
            if (content) {
                content.style.transform = 'scale(0.95)';
                content.style.opacity = '0';
                setTimeout(() => {
                    if (modal) modal.classList.add('hidden');
                }, 300);
            }
            
            // Reset form
            const form = document.getElementById('quickSpeedForm');
            if (form) form.reset();
            
            // Hide preview
            const preview = document.getElementById('speedStatusPreview');
            if (preview) preview.classList.add('hidden');
        }

        function showAddVehicleModal() {
            const modal = document.getElementById('addVehicleModal');
            const content = document.getElementById('addVehicleModalContent');
            if (modal && content) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.style.transform = 'scale(1)';
                    content.style.opacity = '1';
                }, 10);
                
                // Populate drivers
                populateDriverSelect('vehicleDriver');
                
                // Focus first field
                setTimeout(() => {
                    const firstInput = document.getElementById('vehiclePlate');
                    if (firstInput) firstInput.focus();
                }, 100);
            }
        }

        function closeAddVehicleModal() {
            const modal = document.getElementById('addVehicleModal');
            const content = document.getElementById('addVehicleModalContent');
            if (content) {
                content.style.transform = 'scale(0.95)';
                content.style.opacity = '0';
                setTimeout(() => {
                    if (modal) modal.classList.add('hidden');
                }, 300);
            }
            
            // Reset form
            const form = document.getElementById('addVehicleForm');
            if (form) form.reset();
        }

        function showAddDriverModal() {
            const modal = document.getElementById('addDriverModal');
            const content = document.getElementById('addDriverModalContent');
            if (modal && content) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.style.transform = 'scale(1)';
                    content.style.opacity = '1';
                }, 10);
                
                // Focus first field
                setTimeout(() => {
                    const firstInput = document.getElementById('driverName');
                    if (firstInput) firstInput.focus();
                }, 100);
            }
        }

        function closeAddDriverModal() {
            const modal = document.getElementById('addDriverModal');
            const content = document.getElementById('addDriverModalContent');
            if (content) {
                content.style.transform = 'scale(0.95)';
                content.style.opacity = '0';
                setTimeout(() => {
                    if (modal) modal.classList.add('hidden');
                }, 300);
            }
            
            // Reset form
            const form = document.getElementById('addDriverForm');
            if (form) form.reset();
        }

        function showEditVehicleModal(vehicle) {
            const modal = document.getElementById('editVehicleModal');
            const content = document.getElementById('editVehicleModalContent');
            if (modal && content) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.style.transform = 'scale(1)';
                    content.style.opacity = '1';
                }, 10);
                
                // Populate form with vehicle data
                setElementValue('editVehicleId', vehicle.id);
                setElementValue('editVehiclePlate', vehicle.plate);
                setElementValue('editVehicleModel', vehicle.model);
                setElementValue('editVehicleYear', vehicle.year || '');
                setElementValue('editVehicleColor', vehicle.color || '');
                setElementValue('editVehicleTachograph', vehicle.tachographExpiry);
                setElementValue('editVehicleInspection', vehicle.inspectionDate);
                
                // Populate and set driver
                populateDriverSelect('editVehicleDriver');
                setElementValue('editVehicleDriver', vehicle.driverId || '');
            }
        }

        function closeEditVehicleModal() {
            const modal = document.getElementById('editVehicleModal');
            const content = document.getElementById('editVehicleModalContent');
            if (content) {
                content.style.transform = 'scale(0.95)';
                content.style.opacity = '0';
                setTimeout(() => {
                    if (modal) modal.classList.add('hidden');
                }, 300);
            }
        }

        function showEditDriverModal(driver) {
            const modal = document.getElementById('editDriverModal');
            const content = document.getElementById('editDriverModalContent');
            if (modal && content) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.style.transform = 'scale(1)';
                    content.style.opacity = '1';
                }, 10);
                
                // Populate form with driver data
                setElementValue('editDriverId', driver.id);
                setElementValue('editDriverName', driver.name);
                setElementValue('editDriverLicense', driver.license);
                setElementValue('editDriverCategory', driver.category);
                setElementValue('editDriverBirthDate', driver.birthDate || '');
                setElementValue('editDriverLicenseExpiry', driver.licenseExpiry);
                setElementValue('editDriverPhone', driver.phone || '');
                setElementValue('editDriverEmail', driver.email || '');
            }
        }

        function closeEditDriverModal() {
            const modal = document.getElementById('editDriverModal');
            const content = document.getElementById('editDriverModalContent');
            if (content) {
                content.style.transform = 'scale(0.95)';
                content.style.opacity = '0';
                setTimeout(() => {
                    if (modal) modal.classList.add('hidden');
                }, 300);
            }
        }

        function showImportModal() {
            const modal = document.getElementById('importModal');
            const content = document.getElementById('importModalContent');
            if (modal && content) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.style.transform = 'scale(1)';
                    content.style.opacity = '1';
                }, 10);
            }
        }

        function closeImportModal() {
            const modal = document.getElementById('importModal');
            const content = document.getElementById('importModalContent');
            if (content) {
                content.style.transform = 'scale(0.95)';
                content.style.opacity = '0';
                setTimeout(() => {
                    if (modal) modal.classList.add('hidden');
                }, 300);
            }
        }

        function showSettingsModal() {
            const modal = document.getElementById('settingsModal');
            const content = document.getElementById('settingsModalContent');
            if (modal && content) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.style.transform = 'scale(1)';
                    content.style.opacity = '1';
                }, 10);
                
                // Populate current settings
                setElementChecked('autoSaveEnabled', app.settings.autoSave);
                setElementChecked('notificationsEnabled', app.settings.notificationsEnabled);
                setElementChecked('soundNotifications', app.settings.soundNotifications);
                setElementChecked('emailAlerts', app.settings.emailAlerts);
                setElementChecked('speedAlerts', app.settings.speedAlerts);
                setElementValue('itemsPerPage', app.settings.itemsPerPage);
                setElementValue('alertDays', app.settings.alertDays);
                setElementValue('themeSelector', app.settings.theme);
                
                // Populate system info
                app.populateSystemInfo();
            }
        }

        function closeSettingsModal() {
            const modal = document.getElementById('settingsModal');
            const content = document.getElementById('settingsModalContent');
            if (content) {
                content.style.transform = 'scale(0.95)';
                content.style.opacity = '0';
                setTimeout(() => {
                    if (modal) modal.classList.add('hidden');
                }, 300);
            }
        }

        function saveSettings() {
            try {
                app.settings.autoSave = getElementChecked('autoSaveEnabled');
                app.settings.notificationsEnabled = getElementChecked('notificationsEnabled');
                app.settings.soundNotifications = getElementChecked('soundNotifications');
                app.settings.emailAlerts = getElementChecked('emailAlerts');
                app.settings.speedAlerts = getElementChecked('speedAlerts');
                app.settings.itemsPerPage = parseInt(getElementValue('itemsPerPage')) || 25;
                app.settings.alertDays = parseInt(getElementValue('alertDays')) || 30;
                app.settings.theme = getElementValue('themeSelector') || 'auto';
                
                if (app.saveSettings()) {
                    // Update pagination if items per page changed
                    app.pagination.vehicles.itemsPerPage = app.settings.itemsPerPage;
                    app.pagination.drivers.itemsPerPage = app.settings.itemsPerPage;
                    app.pagination.speedRecords.itemsPerPage = app.settings.itemsPerPage;
                    
                    closeSettingsModal();
                    showToast('Configurações Salvas', 'As configurações foram salvas com sucesso', 'success');
                    
                    // Refresh current view
                    updateAllTables();
                } else {
                    showToast('Erro', 'Falha ao salvar configurações', 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar configurações:', error);
                showToast('Erro', 'Erro inesperado ao salvar configurações', 'error');
            }
        }

        function resetSettings() {
            showConfirmDialog('Tem certeza que deseja restaurar as configurações padrão?', () => {
                app.settings = { ...app.defaultSettings };
                app.saveSettings();
                closeSettingsModal();
                showToast('Configurações Restauradas', 'Configurações foram restauradas ao padrão', 'info');
                updateAllTables();
            });
        }

        // ========================================
        // ENHANCED FORM HANDLING
        // ========================================

        function setupEventListeners() {
            // Speed Entry Form
            const speedForm = document.getElementById('speedEntryForm');
            if (speedForm) {
                speedForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleSpeedEntry();
                });
            }

            // Quick Speed Form
            const quickSpeedForm = document.getElementById('quickSpeedForm');
            if (quickSpeedForm) {
                quickSpeedForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleQuickSpeedEntry();
                });
            }
            
            // Add Vehicle Form
            const addVehicleForm = document.getElementById('addVehicleForm');
            if (addVehicleForm) {
                addVehicleForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleAddVehicle();
                });
            }
            
            // Add Driver Form
            const addDriverForm = document.getElementById('addDriverForm');
            if (addDriverForm) {
                addDriverForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleAddDriver();
                });
            }
            
            // Edit Vehicle Form
            const editVehicleForm = document.getElementById('editVehicleForm');
            if (editVehicleForm) {
                editVehicleForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleEditVehicle();
                });
            }
            
            // Edit Driver Form
            const editDriverForm = document.getElementById('editDriverForm');
            if (editDriverForm) {
                editDriverForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleEditDriver();
                });
            }

            // Close modals when clicking outside
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('fixed') && e.target.classList.contains('inset-0')) {
                    const modals = ['speedEntryModal', 'addVehicleModal', 'addDriverModal', 'editVehicleModal', 'editDriverModal', 'importModal', 'settingsModal'];
                    modals.forEach(modalId => {
                        const modal = document.getElementById(modalId);
                        if (modal && !modal.classList.contains('hidden')) {
                            const closeFunction = window[`close${modalId.charAt(0).toUpperCase() + modalId.slice(1, -5)}Modal`];
                            if (closeFunction) closeFunction();
                        }
                    });
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    // Close any open modals
                    const modals = ['speedEntryModal', 'addVehicleModal', 'addDriverModal', 'editVehicleModal', 'editDriverModal', 'importModal', 'settingsModal'];
                    modals.forEach(modalId => {
                        const modal = document.getElementById(modalId);
                        if (modal && !modal.classList.contains('hidden')) {
                            const closeFunction = window[`close${modalId.charAt(0).toUpperCase() + modalId.slice(1, -5)}Modal`];
                            if (closeFunction) closeFunction();
                        }
                    });
                    
                    // Close notifications panel
                    const notificationsPanel = document.getElementById('notificationsPanel');
                    if (notificationsPanel && !notificationsPanel.classList.contains('hidden')) {
                        notificationsPanel.classList.add('hidden');
                    }
                }
            });
        }

        function handleSpeedEntry() {
            try {
                const driverId = parseInt(getElementValue('speedDriverSelect'));
                const speed = parseInt(getElementValue('speedValue'));
                const speedLimit = parseInt(getElementValue('speedLimit'));
                const datetime = getElementValue('speedDateTime');
                const location = getElementValue('speedLocation');
                const observations = getElementValue('speedObservations');
                
                if (!driverId || !speed || !speedLimit || !datetime || !location) {
                    showToast('Campos Obrigatórios', 'Preencha todos os campos obrigatórios', 'warning');
                    return;
                }
                
                const driver = app.data.drivers.find(d => d.id === driverId);
                if (!driver) {
                    showToast('Erro', 'Motorista não encontrado', 'error');
                    return;
                }

                const vehicle = app.data.vehicles.find(v => v.driver === driver.name);
                
                const speedRecord = {
                    driverId: driverId,
                    driverName: driver.name,
                    vehiclePlate: vehicle ? vehicle.plate : '',
                    speed: speed,
                    speedLimit: speedLimit,
                    datetime: datetime,
                    location: location,
                    observations: observations,
                    status: calculateSpeedStatus(speed, speedLimit)
                };
                
                app.addSpeedRecord(speedRecord);
                updateSpeedTracking();
                updateDashboard();
                updateDataStatistics();
                
                // Reset form
                document.getElementById('speedEntryForm').reset();
                
                showToast('Velocidade Registrada', `Velocidade de ${driver.name} registrada: ${speed}km/h`, 'success');
                
            } catch (error) {
                console.error('Erro ao registrar velocidade:', error);
                showToast('Erro', error.message || 'Erro ao registrar velocidade', 'error');
            }
        }

        function handleQuickSpeedEntry() {
            try {
                const driverId = parseInt(getElementValue('quickSpeedDriver'));
                const speed = parseInt(getElementValue('quickSpeedValue'));
                const speedLimit = parseInt(getElementValue('quickSpeedLimit'));
                const datetime = getElementValue('quickSpeedDateTime');
                const location = getElementValue('quickSpeedLocation');
                
                if (!driverId || !speed || !speedLimit || !datetime || !location) {
                    showToast('Campos Obrigatórios', 'Preencha todos os campos obrigatórios', 'warning');
                    return;
                }
                
                const driver = app.data.drivers.find(d => d.id === driverId);
                if (!driver) {
                    showToast('Erro', 'Motorista não encontrado', 'error');
                    return;
                }

                const vehicle = app.data.vehicles.find(v => v.driver === driver.name);
                
                const speedRecord = {
                    driverId: driverId,
                    driverName: driver.name,
                    vehiclePlate: vehicle ? vehicle.plate : '',
                    speed: speed,
                    speedLimit: speedLimit,
                    datetime: datetime,
                    location: location,
                    observations: '',
                    status: calculateSpeedStatus(speed, speedLimit)
                };
                
                app.addSpeedRecord(speedRecord);
                closeSpeedEntryModal();
                updateSpeedTracking();
                updateDashboard();
                updateDataStatistics();
                
                showToast('Velocidade Registrada', `Velocidade de ${driver.name} registrada: ${speed}km/h`, 'success');
                
            } catch (error) {
                console.error('Erro ao registrar velocidade:', error);
                showToast('Erro', error.message || 'Erro ao registrar velocidade', 'error');
            }
        }

        function handleAddVehicle() {
            try {
                const vehicleData = {
                    plate: getElementValue('vehiclePlate').toUpperCase(),
                    model: getElementValue('vehicleModel'),
                    year: parseInt(getElementValue('vehicleYear')) || null,
                    color: getElementValue('vehicleColor'),
                    driverId: parseInt(getElementValue('vehicleDriver')) || null,
                    driver: '',
                    tachographExpiry: getElementValue('vehicleTachograph'),
                    inspectionDate: getElementValue('vehicleInspection')
                };
                
                // Set driver name if driver selected
                if (vehicleData.driverId) {
                    const driver = app.data.drivers.find(d => d.id === vehicleData.driverId);
                    if (driver) {
                        vehicleData.driver = driver.name;
                        // Update driver's current vehicle
                        driver.currentVehicle = vehicleData.plate;
                    }
                }
                
                app.addVehicle(vehicleData);
                closeAddVehicleModal();
                updateVehiclesTable();
                updateDashboard();
                updateDataStatistics();
                
                showToast('Veículo Adicionado', `Veículo ${vehicleData.plate} foi adicionado com sucesso`, 'success');
                
            } catch (error) {
                console.error('Erro ao adicionar veículo:', error);
                showToast('Erro', error.message || 'Erro ao adicionar veículo', 'error');
            }
        }

        function handleAddDriver() {
            try {
                const driverData = {
                    name: getElementValue('driverName'),
                    license: getElementValue('driverLicense'),
                    category: getElementValue('driverCategory'),
                    birthDate: getElementValue('driverBirthDate') || null,
                    licenseExpiry: getElementValue('driverLicenseExpiry'),
                    phone: getElementValue('driverPhone') || null,
                    email: getElementValue('driverEmail') || null
                };
                
                app.addDriver(driverData);
                closeAddDriverModal();
                updateDriversTable();
                updateDashboard();
                updateDataStatistics();
                populateSelects(); // Update driver selects
                
                showToast('Motorista Adicionado', `Motorista ${driverData.name} foi adicionado com sucesso`, 'success');
                
            } catch (error) {
                console.error('Erro ao adicionar motorista:', error);
                showToast('Erro', error.message || 'Erro ao adicionar motorista', 'error');
            }
        }

        function handleEditVehicle() {
            try {
                const vehicleId = parseInt(getElementValue('editVehicleId'));
                const updates = {
                    plate: getElementValue('editVehiclePlate').toUpperCase(),
                    model: getElementValue('editVehicleModel'),
                    year: parseInt(getElementValue('editVehicleYear')) || null,
                    color: getElementValue('editVehicleColor'),
                    driverId: parseInt(getElementValue('editVehicleDriver')) || null,
                    driver: '',
                    tachographExpiry: getElementValue('editVehicleTachograph'),
                    inspectionDate: getElementValue('editVehicleInspection')
                };
                
                // Set driver name if driver selected
                if (updates.driverId) {
                    const driver = app.data.drivers.find(d => d.id === updates.driverId);
                    if (driver) {
                        updates.driver = driver.name;
                        // Update driver's current vehicle
                        driver.currentVehicle = updates.plate;
                    }
                }
                
                app.updateVehicle(vehicleId, updates);
                closeEditVehicleModal();
                updateVehiclesTable();
                updateDashboard();
                updateDataStatistics();
                
                showToast('Veículo Atualizado', `Veículo ${updates.plate} foi atualizado com sucesso`, 'success');
                
            } catch (error) {
                console.error('Erro ao atualizar veículo:', error);
                showToast('Erro', error.message || 'Erro ao atualizar veículo', 'error');
            }
        }

        function handleEditDriver() {
            try {
                const driverId = parseInt(getElementValue('editDriverId'));
                const updates = {
                    name: getElementValue('editDriverName'),
                    license: getElementValue('editDriverLicense'),
                    category: getElementValue('editDriverCategory'),
                    birthDate: getElementValue('editDriverBirthDate') || null,
                    licenseExpiry: getElementValue('editDriverLicenseExpiry'),
                    phone: getElementValue('editDriverPhone') || null,
                    email: getElementValue('editDriverEmail') || null
                };
                
                app.updateDriver(driverId, updates);
                closeEditDriverModal();
                updateDriversTable();
                updateDashboard();
                updateDataStatistics();
                
                showToast('Motorista Atualizado', `Motorista ${updates.name} foi atualizado com sucesso`, 'success');
                
            } catch (error) {
                console.error('Erro ao atualizar motorista:', error);
                showToast('Erro', error.message || 'Erro ao atualizar motorista', 'error');
            }
        }

        // ========================================
        // ENHANCED VALIDATION FUNCTIONS
        // ========================================

        function validatePlate(input) {
            const plate = input.value.toUpperCase();
            const validation = input.nextElementSibling;
            
            if (plate.length === 0) {
                validation.classList.add('hidden');
                return;
            }
            
            const isValid = app.validatePlateFormat(plate);
            
            if (validation) {
                if (isValid) {
                    validation.textContent = '✓ Formato válido';
                    validation.className = 'text-xs mt-1 text-green-600 dark:text-green-400';
                } else {
                    validation.textContent = '✗ Formato inválido (ex: ABC-1234)';
                    validation.className = 'text-xs mt-1 text-red-600 dark:text-red-400';
                }
                validation.classList.remove('hidden');
            }
            
            input.value = plate;
        }

        function validateCNH(input) {
            const cnh = input.value.replace(/\D/g, '');
            const validation = input.nextElementSibling;
            
            if (cnh.length === 0) {
                validation.classList.add('hidden');
                return;
            }
            
            const isValid = cnh.length === 11;
            
            if (validation) {
                if (isValid) {
                    validation.textContent = '✓ CNH válida';
                    validation.className = 'text-xs mt-1 text-green-600 dark:text-green-400';
                } else {
                    validation.textContent = '✗ CNH deve ter 11 dígitos';
                    validation.className = 'text-xs mt-1 text-red-600 dark:text-red-400';
                }
                validation.classList.remove('hidden');
            }
            
            input.value = cnh;
        }

        function formatPhone(input) {
            let phone = input.value.replace(/\D/g, '');
            
            if (phone.length >= 11) {
                phone = phone.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (phone.length >= 10) {
                phone = phone.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
            } else if (phone.length >= 6) {
                phone = phone.replace(/(\d{2})(\d{4})/, '($1) $2');
            } else if (phone.length >= 2) {
                phone = phone.replace(/(\d{2})/, '($1) ');
            }
            
            input.value = phone;
        }

        function updateSpeedIndicator() {
            const speedValue = parseInt(getElementValue('speedValue') || getElementValue('quickSpeedValue')) || 0;
            const speedLimit = parseInt(getElementValue('speedLimit') || getElementValue('quickSpeedLimit')) || 80;
            
            const indicators = ['speedIndicator', 'speedIndicatorMain'];
            const preview = document.getElementById('speedStatusPreview');
            const statusText = document.getElementById('speedStatusText');
            const previewBar = document.getElementById('speedPreviewBar');
            
            const status = calculateSpeedStatus(speedValue, speedLimit);
            let color = 'bg-gray-400';
            let previewColor = 'bg-gray-400';
            
            if (speedValue > 0) {
                if (status === 'Normal') {
                    color = 'bg-green-500';
                    previewColor = 'bg-green-500';
                } else if (status === 'Infração') {
                    color = 'bg-yellow-500';
                    previewColor = 'bg-yellow-500';
                } else if (status === 'Infração Grave') {
                    color = 'bg-red-500';
                    previewColor = 'bg-red-500';
                }
                
                if (preview && statusText && previewBar) {
                    preview.classList.remove('hidden');
                    statusText.textContent = status;
                    statusText.className = `text-sm font-medium ${status === 'Normal' ? 'text-green-600' : status === 'Infração' ? 'text-yellow-600' : 'text-red-600'}`;
                    previewBar.className = `h-2 rounded-full transition-all duration-500 ${previewColor}`;
                    previewBar.style.width = `${Math.min((speedValue / speedLimit) * 100, 100)}%`;
                }
            } else if (preview) {
                preview.classList.add('hidden');
            }
            
            indicators.forEach(id => {
                const indicator = document.getElementById(id);
                if (indicator) {
                    indicator.className = `absolute right-3 top-3 w-3 h-3 rounded-full transition-all duration-300 ${color}`;
                }
            });
        }

        function calculateSpeedStatus(speed, speedLimit) {
            const excess = speed - speedLimit;
            const excessPercentage = (excess / speedLimit) * 100;
            
            if (excess <= 0) {
                return 'Normal';
            } else if (excessPercentage <= 20) {
                return 'Infração';
            } else {
                return 'Infração Grave';
            }
        }

        // ========================================
        // ENHANCED UTILITY FUNCTIONS
        // ========================================

        function populateSelects() {
            populateDriverSelects();
            populateYearFilters();
        }

        function populateDriverSelects() {
            const selects = ['speedDriverSelect', 'quickSpeedDriver', 'vehicleDriver', 'editVehicleDriver', 'speedHistoryDriver', 'reportDriver'];
            
            selects.forEach(selectId => {
                populateDriverSelect(selectId);
            });
        }

        function populateDriverSelect(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const currentValue = select.value;
            const firstOption = select.querySelector('option[value=""]');
            
            // Clear all options except the first empty one
            select.innerHTML = '';
            if (firstOption) {
                select.appendChild(firstOption);
            }
            
            // Add driver options
            app.data.drivers.forEach(driver => {
                const option = document.createElement('option');
                option.value = driver.id;
                option.textContent = `${driver.name} (${driver.category})`;
                select.appendChild(option);
            });
            
            // Restore previous value if still valid
            if (currentValue) {
                select.value = currentValue;
            }
        }

        function populateYearFilters() {
            const yearFilter = document.getElementById('vehicleYearFilter');
            if (!yearFilter) return;
            
            const years = new Set();
            app.data.vehicles.forEach(vehicle => {
                if (vehicle.year) {
                    years.add(vehicle.year);
                }
            });
            
            const sortedYears = Array.from(years).sort((a, b) => b - a);
            
            // Keep first option and clear others
            const firstOption = yearFilter.querySelector('option[value=""]');
            yearFilter.innerHTML = '';
            if (firstOption) {
                yearFilter.appendChild(firstOption);
            }
            
            sortedYears.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
            });
        }

        function populateReportSelects() {
            populateDriverSelect('reportDriver');
        }

        function getStatusClass(status) {
            switch (status) {
                case 'Em dia':
                    return 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200';
                case 'A vencer':
                    return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-200';
                case 'Vencido':
                    return 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200';
                default:
                    return 'bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-200';
            }
        }

        function getSpeedStatusClass(status) {
            switch (status) {
                case 'Normal':
                    return 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200';
                case 'Infração':
                    return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-200';
                case 'Infração Grave':
                    return 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200';
                default:
                    return 'bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-200';
            }
        }

        function getDaysUntilExpiry(dateString) {
            const today = new Date();
            const expiryDate = new Date(dateString);
            const diffTime = expiryDate - today;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        function updateAllTables() {
            updateVehiclesTable();
            updateDriversTable();
            updateSpeedHistoryTable();
            updateVehicleStatistics();
            updateDriverStatistics();
        }

        function updateDataStatistics() {
            const stats = app.getStats();
            
            setElementText('totalRecords', stats.totalVehicles + stats.totalDrivers + stats.totalSpeedRecords);
            setElementText('lastUpdate', new Date().toLocaleString('pt-BR'));
            
            const dataSize = JSON.stringify(app.data).length;
            setElementText('dataSize', `${Math.round(dataSize / 1024)} KB`);
            
            // Update backup tab statistics
            setElementText('statsVehicles', stats.totalVehicles);
            setElementText('statsDrivers', stats.totalDrivers);
            setElementText('statsSpeed', stats.totalSpeedRecords);
            setElementText('statsActivities', stats.totalActivities);
        }

        // ========================================
        // ENHANCED CHARTS INITIALIZATION
        // ========================================

        function initCharts() {
            initDocumentsChart();
            initViolationsChart();
        }

        function initDocumentsChart() {
            const ctx = document.getElementById('documentsChart');
            if (!ctx) return;
            
            try {
                const { expiringSoon, expired } = calculateExpirations();
                const total = app.data.vehicles.length + app.data.drivers.length;
                const upToDate = total - expiringSoon - expired;
                
                if (app.charts.documents) {
                    app.charts.documents.destroy();
                }
                
                app.charts.documents = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Em dia', 'A vencer', 'Vencidos'],
                        datasets: [{
                            data: [upToDate, expiringSoon, expired],
                            backgroundColor: [
                                '#10B981',
                                '#F59E0B',
                                '#EF4444'
                            ],
                            borderWidth: 0,
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed;
                                        const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        cutout: '60%',
                        animation: {
                            animateRotate: true,
                            duration: 1000
                        }
                    }
                });
            } catch (error) {
                console.error('Erro ao inicializar gráfico de documentos:', error);
            }
        }

        function initViolationsChart() {
            const ctx = document.getElementById('violationsChart');
            if (!ctx) return;
            
            try {
                const period = parseInt(getElementValue('violationsChartPeriod')) || 7;
                const violationsData = getViolationsData(period);
                
                if (app.charts.violations) {
                    app.charts.violations.destroy();
                }
                
                app.charts.violations = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: violationsData.labels,
                        datasets: [{
                            label: 'Infrações',
                            data: violationsData.data,
                            borderColor: '#EF4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3,
                            pointBackgroundColor: '#EF4444',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: '#EF4444',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Data'
                                },
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Número de Infrações'
                                },
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            } catch (error) {
                console.error('Erro ao inicializar gráfico de infrações:', error);
            }
        }

        function getViolationsData(days) {
            const labels = [];
            const data = [];
            const today = new Date();
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateString = date.toISOString().split('T')[0];
                
                labels.push(date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }));
                
                const dayViolations = app.data.speedRecords.filter(record => {
                    return record.datetime.startsWith(dateString) && record.status.includes('Infração');
                }).length;
                
                data.push(dayViolations);
            }
            
            return { labels, data };
        }

        function refreshDocumentsChart() {
            initDocumentsChart();
            showToast('Atualizado', 'Gráfico de documentos foi atualizado', 'success');
        }

        function refreshViolationsChart() {
            initViolationsChart();
            showToast('Atualizado', 'Gráfico de infrações foi atualizado', 'success');
        }

        function toggleChartType(chartName) {
            // Future enhancement: toggle between chart types
            showToast('Funcionalidade', 'Alternância de tipo de gráfico será implementada em breve', 'info');
        }

        // ========================================
        // ENHANCED NOTIFICATION FUNCTIONS
        // ========================================

        function showNotificationsPanel() {
            const panel = document.getElementById('notificationsPanel');
            const list = document.getElementById('notificationsList');
            const count = document.getElementById('notificationCount');
            
            if (panel) {
                const isHidden = panel.classList.contains('hidden');
                
                if (isHidden) {
                    panel.classList.remove('hidden');
                    updateNotificationsList();
                } else {
                    panel.classList.add('hidden');
                }
            }
        }

        function updateNotificationsList() {
            const list = document.getElementById('notificationsList');
            if (!list) return;
            
            const notifications = app.data.notifications;
            
            if (notifications.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-bell-slash text-gray-300 dark:text-gray-600 text-4xl mb-3"></i>
                        <p class="text-gray-500 dark:text-gray-400 font-medium">Nenhuma notificação</p>
                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">Você está em dia!</p>
                    </div>
                `;
            } else {
                list.innerHTML = notifications.map(notification => {
                    const iconClass = {
                        success: 'fas fa-check-circle text-green-500',
                        warning: 'fas fa-exclamation-triangle text-yellow-500',
                        error: 'fas fa-times-circle text-red-500',
                        info: 'fas fa-info-circle text-blue-500'
                    }[notification.type] || 'fas fa-bell text-gray-500';
                    
                    return `
                        <div class="p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200 ${!notification.read ? 'bg-primary/5 border-l-2 border-primary' : ''}">
                            <div class="flex items-start">
                                <i class="${iconClass} mr-3 mt-1"></i>
                                <div class="flex-1">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">${notification.title}</p>
                                            <p class="text-xs text-gray-600 dark:text-gray-300 mt-1">${notification.message}</p>
                                            <p class="text-xs text-gray-400 dark:text-gray-500 mt-2">
                                                ${new Date(notification.datetime).toLocaleString('pt-BR')}
                                            </p>
                                        </div>
                                        ${!notification.read ? `<div class="w-2 h-2 bg-primary rounded-full"></div>` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function markAllAsRead() {
            app.markAllNotificationsAsRead();
            updateNotificationsList();
            showToast('Notificações', 'Todas as notificações foram marcadas como lidas', 'info');
        }

        function clearAllNotifications() {
            showConfirmDialog('Tem certeza que deseja limpar todas as notificações?', () => {
                app.clearAllNotifications();
                updateNotificationsList();
                showToast('Notificações', 'Todas as notificações foram removidas', 'info');
            });
        }

        // ========================================
        // ENHANCED TOAST AND DIALOG FUNCTIONS
        // ========================================

        function showToast(title, message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            const toastProgress = document.getElementById('toastProgress');
            
            if (!toast || !toastIcon || !toastTitle || !toastMessage) return;
            
            const icons = {
                success: 'fas fa-check-circle text-green-500',
                warning: 'fas fa-exclamation-triangle text-yellow-500',
                error: 'fas fa-times-circle text-red-500',
                info: 'fas fa-info-circle text-blue-500'
            };
            
            const borderColors = {
                success: 'border-green-500',
                warning: 'border-yellow-500',
                error: 'border-red-500',
                info: 'border-blue-500'
            };
            
            toastIcon.className = icons[type] || icons.info;
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            const toastContainer = toast.firstElementChild;
            toastContainer.className = `bg-white dark:bg-gray-800 border-l-4 rounded-lg shadow-xl p-4 max-w-sm transform transition-all duration-300 animate-slide-up ${borderColors[type] || borderColors.info}`;
            
            toast.classList.remove('hidden');
            
            if (toastProgress) {
                toastProgress.style.width = '100%';
                setTimeout(() => {
                    toastProgress.style.width = '0%';
                }, 100);
            }
            
            setTimeout(() => {
                hideToast();
            }, 5000);
        }

        function hideToast() {
            const toast = document.getElementById('toast');
            if (toast) {
                toast.classList.add('hidden');
            }
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full transform transition-all duration-300 scale-95 opacity-0">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-question-circle text-warning text-2xl mr-3"></i>
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Confirmação</h3>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 mb-6">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200">Cancelar</button>
                        <button onclick="this.closest('.fixed').remove(); (${onConfirm.toString()})()" class="px-4 py-2 bg-gradient-to-r from-danger to-danger/80 text-white hover:from-danger/90 hover:to-danger/70 rounded-lg transition-all duration-200 font-medium">Confirmar</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            setTimeout(() => {
                const content = modal.querySelector('div > div');
                if (content) {
                    content.style.transform = 'scale(1)';
                    content.style.opacity = '1';
                }
            }, 10);
        }

        function showCustomDialog(title, content) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto transform transition-all duration-300 scale-95 opacity-0">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">${title}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="text-gray-700 dark:text-gray-300">${content}</div>
                    <div class="flex justify-end mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 bg-primary text-white hover:bg-primary/90 rounded-lg transition-all duration-200">Fechar</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            setTimeout(() => {
                const content = modal.querySelector('div > div');
                if (content) {
                    content.style.transform = 'scale(1)';
                    content.style.opacity = '1';
                }
            }, 10);
        }

        // ========================================
        // ENHANCED HELPER FUNCTIONS
        // ========================================

        function setElementText(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }

        function setElementValue(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.value = value;
            }
        }

        function getElementValue(id) {
            const element = document.getElementById(id);
            return element ? element.value : '';
        }

        function setElementChecked(id, checked) {
            const element = document.getElementById(id);
            if (element) {
                element.checked = checked;
            }
        }

        function getElementChecked(id) {
            const element = document.getElementById(id);
            return element ? element.checked : false;
        }

        // ========================================
        // ENHANCED EXPORT/IMPORT FUNCTIONS
        // ========================================

        function exportAllData() {
            try {
                app.exportData('all', 'json', 'all');
                showToast('Backup Completo', 'Todos os dados foram exportados', 'success');
            } catch (error) {
                console.error('Erro ao exportar dados:', error);
                showToast('Erro', 'Falha ao exportar dados', 'error');
            }
        }

        function exportToExcel() {
            try {
                app.exportData('all', 'xlsx', 'all');
                showToast('Excel Exportado', 'Dados exportados para Excel com sucesso', 'success');
            } catch (error) {
                console.error('Erro ao exportar para Excel:', error);
                showToast('Erro', 'Falha ao exportar para Excel', 'error');
            }
        }

        function exportSelectedData() {
            try {
                const type = getElementValue('exportType') || 'all';
                const format = getElementValue('exportFormat') || 'json';
                const period = getElementValue('exportPeriod') || 'all';
                
                app.exportData(type, format, period);
                showToast('Dados Exportados', `Exportação ${format.toUpperCase()} concluída`, 'success');
            } catch (error) {
                console.error('Erro ao exportar dados selecionados:', error);
                showToast('Erro', 'Falha na exportação', 'error');
            }
        }

        function forceSave() {
            try {
                showLoadingOverlay();
                app.updateSaveStatus('saving');
                
                setTimeout(() => {
                    if (app.saveData()) {
                        showToast('Dados Salvos', 'Todos os dados foram salvos com sucesso', 'success');
                    } else {
                        showToast('Erro', 'Falha ao salvar dados', 'error');
                    }
                    hideLoadingOverlay();
                }, 500);
            } catch (error) {
                console.error('Erro ao forçar salvamento:', error);
                showToast('Erro', 'Erro inesperado ao salvar', 'error');
                hideLoadingOverlay();
            }
        }

        function downloadAllData() {
            exportAllData();
        }

        function validateData() {
            try {
                showLoadingOverlay();
                
                setTimeout(() => {
                    let errors = 0;
                    
                    // Validate vehicles
                    app.data.vehicles.forEach(vehicle => {
                        if (!app.validateVehicleData(vehicle, true)) {
                            errors++;
                        }
                    });
                    
                    // Validate drivers
                    app.data.drivers.forEach(driver => {
                        if (!app.validateDriverData(driver, true)) {
                            errors++;
                        }
                    });
                    
                    hideLoadingOverlay();
                    
                    if (errors === 0) {
                        showToast('Validação Completa', 'Todos os dados estão íntegros e válidos', 'success');
                    } else {
                        showToast('Problemas Encontrados', `${errors} registros com problemas de validação`, 'warning');
                    }
                }, 1000);
            } catch (error) {
                console.error('Erro na validação:', error);
                hideLoadingOverlay();
                showToast('Erro', 'Erro inesperado na validação', 'error');
            }
        }

        function clearAllData() {
            showConfirmDialog('⚠️ ATENÇÃO: Esta ação irá REMOVER TODOS OS DADOS permanentemente. Tem certeza?', () => {
                try {
                    app.data = { ...app.defaultData };
                    app.autoSave();
                    updateAllTables();
                    updateDashboard();
                    updateDataStatistics();
                    showToast('Dados Limpos', 'Todos os dados foram removidos', 'warning');
                } catch (error) {
                    console.error('Erro ao limpar dados:', error);
                    showToast('Erro', 'Erro ao limpar dados', 'error');
                }
            });
        }

        function importSampleData() {
            try {
                showLoadingOverlay();
                
                const sampleData = {
                    vehicles: [
                        {
                            id: 1,
                            plate: 'ABC-1234',
                            model: 'Volvo FH 540',
                            year: 2020,
                            color: 'Branco',
                            driver: 'João Silva',
                            driverId: 1,
                            tachographExpiry: new Date(Date.now() + (60 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0],
                            inspectionDate: new Date(Date.now() - (180 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0],
                            status: 'Em dia'
                        },
                        {
                            id: 2,
                            plate: 'DEF-5678',
                            model: 'Scania R450',
                            year: 2019,
                            color: 'Azul',
                            driver: 'Maria Santos',
                            driverId: 2,
                            tachographExpiry: new Date(Date.now() + (15 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0],
                            inspectionDate: new Date(Date.now() - (90 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0],
                            status: 'A vencer'
                        }
                    ],
                    drivers: [
                        {
                            id: 1,
                            name: 'João Silva',
                            license: '12345678901',
                            category: 'E',
                            licenseExpiry: new Date(Date.now() + (120 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0],
                            currentVehicle: 'ABC-1234',
                            status: 'Ativo',
                            phone: '(11) 99999-1234',
                            email: 'joao@exemplo.com'
                        },
                        {
                            id: 2,
                            name: 'Maria Santos',
                            license: '10987654321',
                            category: 'D',
                            licenseExpiry: new Date(Date.now() + (200 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0],
                            currentVehicle: 'DEF-5678',
                            status: 'Ativo',
                            phone: '(11) 99999-5678',
                            email: 'maria@exemplo.com'
                        }
                    ],
                    speedRecords: [
                        {
                            id: 1,
                            driverId: 1,
                            driverName: 'João Silva',
                            vehiclePlate: 'ABC-1234',
                            speed: 85,
                            speedLimit: 80,
                            datetime: new Date().toISOString(),
                            location: 'BR-101, KM 245',
                            status: 'Infração',
                            observations: 'Trânsito normal'
                        },
                        {
                            id: 2,
                            driverId: 2,
                            driverName: 'Maria Santos',
                            vehiclePlate: 'DEF-5678',
                            speed: 75,
                            speedLimit: 80,
                            datetime: new Date(Date.now() - (60 * 60 * 1000)).toISOString(),
                            location: 'SP-348, KM 123',
                            status: 'Normal',
                            observations: ''
                        }
                    ]
                };
                
                setTimeout(() => {
                    const importCount = app.importData(sampleData, false);
                    updateAllTables();
                    updateDashboard();
                    updateDataStatistics();
                    populateSelects();
                    hideLoadingOverlay();
                    showToast('Dados de Exemplo', `${importCount} registros de exemplo foram importados`, 'success');
                }, 1000);
                
            } catch (error) {
                console.error('Erro ao importar dados de exemplo:', error);
                hideLoadingOverlay();
                showToast('Erro', 'Falha ao importar dados de exemplo', 'error');
            }
        }

        function processImport() {
            const fileInput = document.getElementById('modalImportFile');
            const overwrite = getElementChecked('importOverwrite');
            
            if (!fileInput.files.length) {
                showToast('Arquivo Necessário', 'Selecione um arquivo para importar', 'warning');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    showLoadingOverlay();
                    
                    let data;
                    if (file.name.endsWith('.json')) {
                        data = JSON.parse(e.target.result);
                    } else {
                        showToast('Formato Não Suportado', 'Apenas arquivos JSON são suportados atualmente', 'error');
                        hideLoadingOverlay();
                        return;
                    }
                    
                    setTimeout(() => {
                        const importCount = app.importData(data, overwrite);
                        updateAllTables();
                        updateDashboard();
                        updateDataStatistics();
                        populateSelects();
                        closeImportModal();
                        hideLoadingOverlay();
                        showToast('Importação Concluída', `${importCount} registros foram importados`, 'success');
                    }, 1000);
                    
                } catch (error) {
                    console.error('Erro ao processar importação:', error);
                    hideLoadingOverlay();
                    showToast('Erro', 'Arquivo inválido ou corrompido', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const preview = document.getElementById('filePreview');
            const fileName = document.getElementById('fileName');
            const progress = document.getElementById('uploadProgress');
            
            if (preview && fileName) {
                fileName.textContent = file.name;
                preview.classList.remove('hidden');
                
                // Simulate upload progress
                if (progress) {
                    let width = 0;
                    const interval = setInterval(() => {
                        width += 10;
                        progress.style.width = `${width}%`;
                        
                        if (width >= 100) {
                            clearInterval(interval);
                        }
                    }, 50);
                }
            }
        }

        function clearFileSelection() {
            const fileInput = document.getElementById('importFileInput');
            const preview = document.getElementById('filePreview');
            
            if (fileInput) fileInput.value = '';
            if (preview) preview.classList.add('hidden');
        }

        // ========================================
        // ENHANCED REPORTS FUNCTIONS
        // ========================================

        function generateQuickReport() {
            try {
                const stats = app.getStats();
                const { expiringSoon, expired } = calculateExpirations();
                
                const reportHtml = `
                    <div class="space-y-6">
                        <div class="text-center">
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Relatório Rápido da Frota</h2>
                            <p class="text-gray-600 dark:text-gray-400">${new Date().toLocaleString('pt-BR')}</p>
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-blue-600">${stats.totalVehicles}</div>
                                <div class="text-sm text-blue-500">Veículos</div>
                            </div>
                            <div class="text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-green-600">${stats.totalDrivers}</div>
                                <div class="text-sm text-green-500">Motoristas</div>
                            </div>
                            <div class="text-center p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-yellow-600">${expiringSoon}</div>
                                <div class="text-sm text-yellow-500">A Vencer</div>
                            </div>
                            <div class="text-center p-4 bg-red-50 dark:bg-red-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-red-600">${expired}</div>
                                <div class="text-sm text-red-500">Vencidos</div>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button onclick="exportToExcel()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-file-excel mr-2"></i>Exportar para Excel
                            </button>
                        </div>
                    </div>
                `;
                
                showCustomDialog('Relatório Rápido', reportHtml);
                
            } catch (error) {
                console.error('Erro ao gerar relatório rápido:', error);
                showToast('Erro', 'Falha ao gerar relatório rápido', 'error');
            }
        }

        function toggleCustomDateRange() {
            const period = getElementValue('reportPeriod');
            const customRange = document.getElementById('customDateRange');
            
            if (customRange) {
                if (period === 'custom') {
                    customRange.classList.remove('hidden');
                } else {
                    customRange.classList.add('hidden');
                }
            }
        }

        function generateReport() {
            try {
                const type = getElementValue('reportType') || 'general';
                const period = getElementValue('reportPeriod') || '30';
                const driver = getElementValue('reportDriver') || '';
                const format = getElementValue('reportFormat') || 'html';
                
                showLoadingOverlay();
                
                setTimeout(() => {
                    const reportData = app.generateReportData(period, type, driver);
                    const reportHtml = generateReportHTML(reportData, type);
                    
                    const reportContent = document.getElementById('reportContent');
                    if (reportContent) {
                        reportContent.innerHTML = reportHtml;
                    }
                    
                    hideLoadingOverlay();
                    showToast('Relatório Gerado', 'Relatório foi gerado com sucesso', 'success');
                }, 1000);
                
            } catch (error) {
                console.error('Erro ao gerar relatório:', error);
                hideLoadingOverlay();
                showToast('Erro', 'Falha ao gerar relatório', 'error');
            }
        }

        function generateReportHTML(data, type) {
            const title = getReportTitle(type);
            
            return `
                <div class="space-y-6">
                    <div class="text-center border-b border-gray-200 dark:border-gray-700 pb-4">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">${title}</h2>
                        <p class="text-gray-600 dark:text-gray-400 mt-2">
                            Gerado em ${new Date().toLocaleString('pt-BR')}
                        </p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-blue-600">${data.summary.totalVehicles}</div>
                            <div class="text-sm text-blue-500">Total de Veículos</div>
                        </div>
                        <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-green-600">${data.summary.totalDrivers}</div>
                            <div class="text-sm text-green-500">Total de Motoristas</div>
                        </div>
                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-yellow-600">${data.summary.expiringSoon}</div>
                            <div class="text-sm text-yellow-500">Documentos a Vencer</div>
                        </div>
                        <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-red-600">${data.summary.expired}</div>
                            <div class="text-sm text-red-500">Documentos Vencidos</div>
                        </div>
                    </div>
                    
                    ${generateReportDetails(data, type)}
                    
                    <div class="text-center mt-8 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <p class="text-xs text-gray-500 dark:text-gray-400">
                            FleetControl Pro v3.0 - Sistema de Gestão de Frota
                        </p>
                    </div>
                </div>
            `;
        }

        function generateReportDetails(data, type) {
            switch (type) {
                case 'speed':
                    return generateSpeedReportDetails(data);
                case 'maintenance':
                    return generateMaintenanceReportDetails(data);
                case 'drivers':
                    return generateDriversReportDetails(data);
                case 'vehicles':
                    return generateVehiclesReportDetails(data);
                case 'compliance':
                    return generateComplianceReportDetails(data);
                case 'executive':
                    return generateExecutiveReportDetails(data);
                default:
                    return generateGeneralReportDetails(data);
            }
        }

        function generateSpeedReportDetails(data) {
            return `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Infrações de Velocidade</h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-3 gap-4">
                            <div class="text-center">
                                <div class="text-xl font-bold text-green-600">${data.speedStats.normal || 0}</div>
                                <div class="text-sm text-gray-500">Registros Normais</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xl font-bold text-yellow-600">${data.speedStats.violations || 0}</div>
                                <div class="text-sm text-gray-500">Infrações</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xl font-bold text-red-600">${data.speedStats.serious || 0}</div>
                                <div class="text-sm text-gray-500">Infrações Graves</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateGeneralReportDetails(data) {
            return `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Status da Frota</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span>Veículos em Dia:</span>
                                <span class="font-bold text-green-600">${data.fleetStatus.vehiclesOk || 0}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Motoristas Ativos:</span>
                                <span class="font-bold text-blue-600">${data.fleetStatus.activeDrivers || 0}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Taxa de Conformidade:</span>
                                <span class="font-bold text-purple-600">${data.fleetStatus.complianceRate || 0}%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Alertas Urgentes</h3>
                        <div class="space-y-3">
                            ${data.urgentAlerts && data.urgentAlerts.length > 0 ? 
                                data.urgentAlerts.slice(0, 5).map(alert => `
                                    <div class="text-sm p-2 rounded ${alert.type === 'error' ? 'bg-red-50 text-red-800' : 'bg-yellow-50 text-yellow-800'}">
                                        ${alert.message}
                                    </div>
                                `).join('') : 
                                '<div class="text-sm text-gray-500 text-center py-4">Nenhum alerta urgente</div>'
                            }
                        </div>
                    </div>
                </div>
            `;
        }

        function getReportTitle(type) {
            const titles = {
                general: 'Relatório Geral',
                speed: 'Relatório de Infrações de Velocidade',
                maintenance: 'Relatório de Manutenção e Vencimentos',
                drivers: 'Relatório de Performance dos Motoristas',
                vehicles: 'Relatório de Status dos Veículos',
                compliance: 'Relatório de Conformidade',
                executive: 'Resumo Executivo'
            };
            return titles[type] || 'Relatório';
        }

        function exportReport() {
            try {
                const content = document.getElementById('reportContent');
                if (!content || !content.innerHTML.trim()) {
                    showToast('Relatório Vazio', 'Gere um relatório antes de exportar', 'warning');
                    return;
                }
                
                const format = getElementValue('reportFormat') || 'html';
                
                if (format === 'excel') {
                    // Export current report data to Excel
                    app.exportData('reports', 'xlsx', 'all');
                } else if (format === 'pdf') {
                    showToast('Funcionalidade', 'Exportação PDF será implementada em breve', 'info');
                } else {
                    // Export HTML
                    const htmlContent = `
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <meta charset="UTF-8">
                            <title>Relatório FleetControl Pro</title>
                            <style>
                                body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
                                .grid { display: grid; gap: 1rem; }
                                .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
                                .text-center { text-align: center; }
                                .font-bold { font-weight: bold; }
                                .border { border: 1px solid #e5e7eb; padding: 1rem; border-radius: 0.5rem; }
                                .bg-blue-50 { background-color: #eff6ff; }
                                .bg-green-50 { background-color: #f0fdf4; }
                                .bg-yellow-50 { background-color: #fffbeb; }
                                .bg-red-50 { background-color: #fef2f2; }
                            </style>
                        </head>
                        <body>
                            ${content.innerHTML}
                        </body>
                        </html>
                    `;
                    
                    app.downloadFile(htmlContent, 'relatorio-frota.html', 'text/html');
                }
                
                showToast('Relatório Exportado', 'Relatório foi exportado com sucesso', 'success');
                
            } catch (error) {
                console.error('Erro ao exportar relatório:', error);
                showToast('Erro', 'Falha ao exportar relatório', 'error');
            }
        }

        function printReport() {
            const content = document.getElementById('reportContent');
            if (!content || !content.innerHTML.trim()) {
                showToast('Relatório Vazio', 'Gere um relatório antes de imprimir', 'warning');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Relatório FleetControl Pro</title>
                    <style>
                        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
                        .grid { display: grid; gap: 1rem; }
                        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
                        .text-center { text-align: center; }
                        .font-bold { font-weight: bold; }
                        .border { border: 1px solid #e5e7eb; padding: 1rem; border-radius: 0.5rem; }
                        .bg-blue-50 { background-color: #eff6ff; }
                        .bg-green-50 { background-color: #f0fdf4; }
                        .bg-yellow-50 { background-color: #fffbeb; }
                        .bg-red-50 { background-color: #fef2f2; }
                        @media print {
                            body { margin: 0; padding: 10px; }
                        }
                    </style>
                </head>
                <body>
                    ${content.innerHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function shareReport() {
            showToast('Funcionalidade', 'Compartilhamento de relatórios será implementado em breve', 'info');
        }

        function refreshReport() {
            generateReport();
        }

        function scheduleReport() {
            showToast('Funcionalidade', 'Agendamento de relatórios será implementado em breve', 'info');
        }

        function scheduleBackup() {
            showToast('Funcionalidade', 'Agendamento de backups será implementado em breve', 'info');
        }

        function refreshDataStats() {
            updateDataStatistics();
            showToast('Atualizado', 'Estatísticas dos dados foram atualizadas', 'success');
        }

        function analyzeDataTrends() {
            showToast('Funcionalidade', 'Análise de tendências será implementada em breve', 'info');
        }

        function showImportGuide() {
            const guideContent = `
                <div class="space-y-4">
                    <h4 class="font-semibold text-gray-900 dark:text-white">Guia de Importação</h4>
                    
                    <div class="space-y-3">
                        <div>
                            <h5 class="font-medium text-gray-900 dark:text-white">Formato JSON (Backup)</h5>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                Arquivo de backup completo do sistema. Contém todos os dados estruturados.
                            </p>
                        </div>
                        
                        <div>
                            <h5 class="font-medium text-gray-900 dark:text-white">Formato CSV</h5>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                Dados tabulares separados por vírgula. Cada tipo de dado deve estar em arquivo separado.
                            </p>
                        </div>
                        
                        <div>
                            <h5 class="font-medium text-gray-900 dark:text-white">Formato XLSX</h5>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                Planilhas Excel com abas separadas para cada tipo de dado.
                            </p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded border border-yellow-200 dark:border-yellow-800">
                        <p class="text-sm text-yellow-800 dark:text-yellow-200">
                            <strong>Dica:</strong> Para importar dados de sistemas externos, use o formato JSON ou exporte primeiro um arquivo de exemplo.
                        </p>
                    </div>
                </div>
            `;
            showCustomDialog('Guia de Importação', guideContent);
        }

        // Initialize app when document is ready
        console.log('FleetControl Pro v3.0 com Persistência - Pronto para inicialização');
    </script>
</body>
</html>
